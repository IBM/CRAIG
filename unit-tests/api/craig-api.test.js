const { assert } = require("chai");
const res = require("../mocks/response.mock");
const { craigApi } = require("../../express-controllers/craig-api");
const sinon = require("sinon");
const slz = require("../../client/src/lib/docs/templates/slz-mixed.json");

function mockPackTar() {
  this.files = [];
  this.entry = function (options, data) {
    this.files.push({
      name: options.name,
      data: data,
    });
  };
  this.finalize = function () {};
  this.pipe = function () {};
  this.pack = function () {
    return this;
  };
}

describe("craig api", () => {
  describe("craigTar", () => {
    it("should respond with an error when a CRAIG JSON configuration is invalid", () => {
      res.send = new sinon.spy();
      let api = new craigApi({}, new mockPackTar());
      return api.craigTar({ body: {} }, res).catch(() => {
        assert.isTrue(
          res.send.calledOnceWith(
            "TypeError: Cannot read properties of undefined (reading 'classic')"
          ),
          "it should call res send"
        );
      });
    });
    it("should have the correct data in tar on finalize", () => {
      let expectedFiles = [
        { name: "craig", data: "" },
        {
          name: "craig/main.tf",
          data: '##############################################################################\n# IBM Cloud Provider\n##############################################################################\n\nprovider "ibm" {\n  ibmcloud_api_key = var.ibmcloud_api_key\n  region           = var.region\n  ibmcloud_timeout = 60\n}\n\n##############################################################################\n\n##############################################################################\n# Management VPC Module\n##############################################################################\n\nmodule "management_vpc" {\n  source           = "./management_vpc"\n  region           = var.region\n  prefix           = var.prefix\n  management_rg_id = ibm_resource_group.management_rg.id\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\n##############################################################################\n\n##############################################################################\n# Workload VPC Module\n##############################################################################\n\nmodule "workload_vpc" {\n  source         = "./workload_vpc"\n  region         = var.region\n  prefix         = var.prefix\n  workload_rg_id = ibm_resource_group.workload_rg.id\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/flow_logs.tf",
          data: '##############################################################################\n# Flow Logs Resources\n##############################################################################\n\nresource "ibm_iam_authorization_policy" "flow_logs_to_cos_object_storage_policy" {\n  source_service_name         = "is"\n  source_resource_type        = "flow-log-collector"\n  description                 = "Allow flow logs write access cloud object storage instance"\n  target_service_name         = "cloud-object-storage"\n  target_resource_instance_id = ibm_resource_instance.cos_object_storage.guid\n  roles = [\n    "Writer"\n  ]\n}\n\nresource "ibm_is_flow_log" "management_flow_log_collector" {\n  name           = "${var.prefix}-management-vpc-logs"\n  target         = module.management_vpc.id\n  active         = true\n  storage_bucket = ibm_cos_bucket.cos_object_storage_management_bucket_bucket.bucket_name\n  resource_group = ibm_resource_group.management_rg.id\n  tags = [\n    "hello",\n    "world"\n  ]\n  depends_on = [\n    ibm_iam_authorization_policy.flow_logs_to_cos_object_storage_policy\n  ]\n}\n\nresource "ibm_is_flow_log" "workload_flow_log_collector" {\n  name           = "${var.prefix}-workload-vpc-logs"\n  target         = module.workload_vpc.id\n  active         = true\n  storage_bucket = ibm_cos_bucket.cos_object_storage_workload_bucket_bucket.bucket_name\n  resource_group = ibm_resource_group.workload_rg.id\n  tags = [\n    "hello",\n    "world"\n  ]\n  depends_on = [\n    ibm_iam_authorization_policy.flow_logs_to_cos_object_storage_policy\n  ]\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/transit_gateways.tf",
          data: '##############################################################################\n# Transit Gateway Transit Gateway\n##############################################################################\n\nresource "ibm_tg_gateway" "transit_gateway" {\n  name           = "${var.prefix}-transit-gateway"\n  location       = var.region\n  global         = false\n  resource_group = ibm_resource_group.service_rg.id\n  timeouts {\n    create = "30m"\n    delete = "30m"\n  }\n}\n\nresource "ibm_tg_connection" "transit_gateway_to_management_connection" {\n  gateway      = ibm_tg_gateway.transit_gateway.id\n  network_type = "vpc"\n  name         = "${var.prefix}-transit-gateway-management-hub-connection"\n  network_id   = module.management_vpc.crn\n  timeouts {\n    create = "30m"\n    delete = "30m"\n  }\n}\n\nresource "ibm_tg_connection" "transit_gateway_to_workload_connection" {\n  gateway      = ibm_tg_gateway.transit_gateway.id\n  network_type = "vpc"\n  name         = "${var.prefix}-transit-gateway-workload-hub-connection"\n  network_id   = module.workload_vpc.crn\n  timeouts {\n    create = "30m"\n    delete = "30m"\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/virtual_private_endpoints.tf",
          data: '##############################################################################\n# Management VPE Resources\n##############################################################################\n\nresource "ibm_is_subnet_reserved_ip" "management_vpc_vpe_zone_1_subnet_vpe_ip" {\n  subnet = module.management_vpc.vpe_zone_1_id\n}\n\nresource "ibm_is_subnet_reserved_ip" "management_vpc_vpe_zone_2_subnet_vpe_ip" {\n  subnet = module.management_vpc.vpe_zone_2_id\n}\n\nresource "ibm_is_subnet_reserved_ip" "management_vpc_vpe_zone_3_subnet_vpe_ip" {\n  subnet = module.management_vpc.vpe_zone_3_id\n}\n\nresource "ibm_is_virtual_endpoint_gateway" "management_vpc_cos_vpe_gateway" {\n  name           = "${var.prefix}-management-cos-vpe-gw"\n  vpc            = module.management_vpc.id\n  resource_group = ibm_resource_group.management_rg.id\n  tags = [\n    "hello",\n    "world"\n  ]\n  security_groups = [\n    module.management_vpc.management_vpe_id\n  ]\n  target {\n    crn           = "crn:v1:bluemix:public:cloud-object-storage:global:::endpoint:s3.direct.${var.region}.cloud-object-storage.appdomain.cloud"\n    resource_type = "provider_cloud_service"\n  }\n}\n\nresource "ibm_is_virtual_endpoint_gateway_ip" "management_vpc_cos_gw_vpe_zone_1_gateway_ip" {\n  gateway     = ibm_is_virtual_endpoint_gateway.management_vpc_cos_vpe_gateway.id\n  reserved_ip = ibm_is_subnet_reserved_ip.management_vpc_vpe_zone_1_subnet_vpe_ip.reserved_ip\n}\n\nresource "ibm_is_virtual_endpoint_gateway_ip" "management_vpc_cos_gw_vpe_zone_2_gateway_ip" {\n  gateway     = ibm_is_virtual_endpoint_gateway.management_vpc_cos_vpe_gateway.id\n  reserved_ip = ibm_is_subnet_reserved_ip.management_vpc_vpe_zone_2_subnet_vpe_ip.reserved_ip\n}\n\nresource "ibm_is_virtual_endpoint_gateway_ip" "management_vpc_cos_gw_vpe_zone_3_gateway_ip" {\n  gateway     = ibm_is_virtual_endpoint_gateway.management_vpc_cos_vpe_gateway.id\n  reserved_ip = ibm_is_subnet_reserved_ip.management_vpc_vpe_zone_3_subnet_vpe_ip.reserved_ip\n}\n\n##############################################################################\n\n##############################################################################\n# Workload VPE Resources\n##############################################################################\n\nresource "ibm_is_subnet_reserved_ip" "workload_vpc_vpe_zone_1_subnet_vpe_ip" {\n  subnet = module.workload_vpc.vpe_zone_1_id\n}\n\nresource "ibm_is_subnet_reserved_ip" "workload_vpc_vpe_zone_2_subnet_vpe_ip" {\n  subnet = module.workload_vpc.vpe_zone_2_id\n}\n\nresource "ibm_is_subnet_reserved_ip" "workload_vpc_vpe_zone_3_subnet_vpe_ip" {\n  subnet = module.workload_vpc.vpe_zone_3_id\n}\n\nresource "ibm_is_virtual_endpoint_gateway" "workload_vpc_cos_vpe_gateway" {\n  name           = "${var.prefix}-workload-cos-vpe-gw"\n  vpc            = module.workload_vpc.id\n  resource_group = ibm_resource_group.workload_rg.id\n  tags = [\n    "hello",\n    "world"\n  ]\n  security_groups = [\n    module.workload_vpc.workload_vpe_id\n  ]\n  target {\n    crn           = "crn:v1:bluemix:public:cloud-object-storage:global:::endpoint:s3.direct.${var.region}.cloud-object-storage.appdomain.cloud"\n    resource_type = "provider_cloud_service"\n  }\n}\n\nresource "ibm_is_virtual_endpoint_gateway_ip" "workload_vpc_cos_gw_vpe_zone_1_gateway_ip" {\n  gateway     = ibm_is_virtual_endpoint_gateway.workload_vpc_cos_vpe_gateway.id\n  reserved_ip = ibm_is_subnet_reserved_ip.workload_vpc_vpe_zone_1_subnet_vpe_ip.reserved_ip\n}\n\nresource "ibm_is_virtual_endpoint_gateway_ip" "workload_vpc_cos_gw_vpe_zone_2_gateway_ip" {\n  gateway     = ibm_is_virtual_endpoint_gateway.workload_vpc_cos_vpe_gateway.id\n  reserved_ip = ibm_is_subnet_reserved_ip.workload_vpc_vpe_zone_2_subnet_vpe_ip.reserved_ip\n}\n\nresource "ibm_is_virtual_endpoint_gateway_ip" "workload_vpc_cos_gw_vpe_zone_3_gateway_ip" {\n  gateway     = ibm_is_virtual_endpoint_gateway.workload_vpc_cos_vpe_gateway.id\n  reserved_ip = ibm_is_subnet_reserved_ip.workload_vpc_vpe_zone_3_subnet_vpe_ip.reserved_ip\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/virtual_servers.tf",
          data: '##############################################################################\n# Image Data Sources\n##############################################################################\n\ndata "ibm_is_image" "ibm_ubuntu_22_04_1_minimal_amd64_1" {\n  name = "ibm-ubuntu-22-04-1-minimal-amd64-1"\n}\n\n##############################################################################\n\n##############################################################################\n# Management VPC Management Server Deployment\n##############################################################################\n\nresource "ibm_is_instance" "management_vpc_management_server_vsi_1_1" {\n  name           = "${var.prefix}-management-management-server-vsi-zone-1-1"\n  image          = data.ibm_is_image.ibm_ubuntu_22_04_1_minimal_amd64_1.id\n  profile        = "cx2-4x8"\n  resource_group = ibm_resource_group.management_rg.id\n  vpc            = module.management_vpc.id\n  zone           = "${var.region}-1"\n  tags = [\n    "hello",\n    "world"\n  ]\n  primary_network_interface {\n    subnet = module.management_vpc.vsi_zone_1_id\n    security_groups = [\n      module.management_vpc.management_vsi_id\n    ]\n  }\n  boot_volume {\n    encryption = ibm_kms_key.kms_vsi_volume_key_key.crn\n  }\n  keys = [\n    ibm_is_ssh_key.ssh_key.id\n  ]\n  volumes = [\n  ]\n}\n\nresource "ibm_is_instance" "management_vpc_management_server_vsi_1_2" {\n  name           = "${var.prefix}-management-management-server-vsi-zone-1-2"\n  image          = data.ibm_is_image.ibm_ubuntu_22_04_1_minimal_amd64_1.id\n  profile        = "cx2-4x8"\n  resource_group = ibm_resource_group.management_rg.id\n  vpc            = module.management_vpc.id\n  zone           = "${var.region}-1"\n  tags = [\n    "hello",\n    "world"\n  ]\n  primary_network_interface {\n    subnet = module.management_vpc.vsi_zone_1_id\n    security_groups = [\n      module.management_vpc.management_vsi_id\n    ]\n  }\n  boot_volume {\n    encryption = ibm_kms_key.kms_vsi_volume_key_key.crn\n  }\n  keys = [\n    ibm_is_ssh_key.ssh_key.id\n  ]\n  volumes = [\n  ]\n}\n\nresource "ibm_is_instance" "management_vpc_management_server_vsi_2_1" {\n  name           = "${var.prefix}-management-management-server-vsi-zone-2-1"\n  image          = data.ibm_is_image.ibm_ubuntu_22_04_1_minimal_amd64_1.id\n  profile        = "cx2-4x8"\n  resource_group = ibm_resource_group.management_rg.id\n  vpc            = module.management_vpc.id\n  zone           = "${var.region}-2"\n  tags = [\n    "hello",\n    "world"\n  ]\n  primary_network_interface {\n    subnet = module.management_vpc.vsi_zone_2_id\n    security_groups = [\n      module.management_vpc.management_vsi_id\n    ]\n  }\n  boot_volume {\n    encryption = ibm_kms_key.kms_vsi_volume_key_key.crn\n  }\n  keys = [\n    ibm_is_ssh_key.ssh_key.id\n  ]\n  volumes = [\n  ]\n}\n\nresource "ibm_is_instance" "management_vpc_management_server_vsi_2_2" {\n  name           = "${var.prefix}-management-management-server-vsi-zone-2-2"\n  image          = data.ibm_is_image.ibm_ubuntu_22_04_1_minimal_amd64_1.id\n  profile        = "cx2-4x8"\n  resource_group = ibm_resource_group.management_rg.id\n  vpc            = module.management_vpc.id\n  zone           = "${var.region}-2"\n  tags = [\n    "hello",\n    "world"\n  ]\n  primary_network_interface {\n    subnet = module.management_vpc.vsi_zone_2_id\n    security_groups = [\n      module.management_vpc.management_vsi_id\n    ]\n  }\n  boot_volume {\n    encryption = ibm_kms_key.kms_vsi_volume_key_key.crn\n  }\n  keys = [\n    ibm_is_ssh_key.ssh_key.id\n  ]\n  volumes = [\n  ]\n}\n\nresource "ibm_is_instance" "management_vpc_management_server_vsi_3_1" {\n  name           = "${var.prefix}-management-management-server-vsi-zone-3-1"\n  image          = data.ibm_is_image.ibm_ubuntu_22_04_1_minimal_amd64_1.id\n  profile        = "cx2-4x8"\n  resource_group = ibm_resource_group.management_rg.id\n  vpc            = module.management_vpc.id\n  zone           = "${var.region}-3"\n  tags = [\n    "hello",\n    "world"\n  ]\n  primary_network_interface {\n    subnet = module.management_vpc.vsi_zone_3_id\n    security_groups = [\n      module.management_vpc.management_vsi_id\n    ]\n  }\n  boot_volume {\n    encryption = ibm_kms_key.kms_vsi_volume_key_key.crn\n  }\n  keys = [\n    ibm_is_ssh_key.ssh_key.id\n  ]\n  volumes = [\n  ]\n}\n\nresource "ibm_is_instance" "management_vpc_management_server_vsi_3_2" {\n  name           = "${var.prefix}-management-management-server-vsi-zone-3-2"\n  image          = data.ibm_is_image.ibm_ubuntu_22_04_1_minimal_amd64_1.id\n  profile        = "cx2-4x8"\n  resource_group = ibm_resource_group.management_rg.id\n  vpc            = module.management_vpc.id\n  zone           = "${var.region}-3"\n  tags = [\n    "hello",\n    "world"\n  ]\n  primary_network_interface {\n    subnet = module.management_vpc.vsi_zone_3_id\n    security_groups = [\n      module.management_vpc.management_vsi_id\n    ]\n  }\n  boot_volume {\n    encryption = ibm_kms_key.kms_vsi_volume_key_key.crn\n  }\n  keys = [\n    ibm_is_ssh_key.ssh_key.id\n  ]\n  volumes = [\n  ]\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/clusters.tf",
          data: '##############################################################################\n# Workload Cluster Cluster\n##############################################################################\n\nresource "ibm_container_vpc_cluster" "workload_vpc_workload_cluster_cluster" {\n  name                            = "${var.prefix}-workload-cluster-cluster"\n  vpc_id                          = module.workload_vpc.id\n  resource_group_id               = ibm_resource_group.workload_rg.id\n  flavor                          = "bx2.16x64"\n  worker_count                    = 2\n  kube_version                    = "4.12.26_openshift"\n  wait_till                       = "IngressReady"\n  disable_public_service_endpoint = true\n  entitlement                     = "cloud_pak"\n  cos_instance_crn                = ibm_resource_instance.cos_object_storage.crn\n  update_all_workers              = null\n  tags = [\n    "hello",\n    "world"\n  ]\n  zones {\n    name      = "${var.region}-1"\n    subnet_id = module.workload_vpc.vsi_zone_1_id\n  }\n  zones {\n    name      = "${var.region}-2"\n    subnet_id = module.workload_vpc.vsi_zone_2_id\n  }\n  zones {\n    name      = "${var.region}-3"\n    subnet_id = module.workload_vpc.vsi_zone_3_id\n  }\n  timeouts {\n    create = "3h"\n    update = "3h"\n    delete = "2h"\n  }\n  kms_config {\n    crk_id           = ibm_kms_key.kms_roks_key_key.key_id\n    instance_id      = ibm_resource_instance.kms.guid\n    private_endpoint = true\n  }\n}\n\nresource "ibm_container_vpc_worker_pool" "workload_vpc_workload_cluster_cluster_logging_worker_pool_pool" {\n  worker_pool_name  = "${var.prefix}-workload-cluster-cluster-logging-worker-pool"\n  vpc_id            = module.workload_vpc.id\n  resource_group_id = ibm_resource_group.workload_rg.id\n  cluster           = ibm_container_vpc_cluster.workload_vpc_workload_cluster_cluster.id\n  flavor            = "bx2.16x64"\n  worker_count      = 2\n  entitlement       = "cloud_pak"\n  zones {\n    name      = "${var.region}-1"\n    subnet_id = module.workload_vpc.vsi_zone_1_id\n  }\n  zones {\n    name      = "${var.region}-2"\n    subnet_id = module.workload_vpc.vsi_zone_2_id\n  }\n  zones {\n    name      = "${var.region}-3"\n    subnet_id = module.workload_vpc.vsi_zone_3_id\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/vpn_gateways.tf",
          data: '##############################################################################\n# VPN Gateways\n##############################################################################\n\nresource "ibm_is_vpn_gateway" "management_management_gateway_vpn_gw" {\n  name           = "${var.prefix}-management-management-gateway-vpn-gw"\n  subnet         = module.management_vpc.vpn_zone_1_id\n  resource_group = ibm_resource_group.management_rg.id\n  tags = [\n    "hello",\n    "world"\n  ]\n  timeouts {\n    delete = "1h"\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/variables.tf",
          data: '##############################################################################\n# Variables\n##############################################################################\n\nvariable "ibmcloud_api_key" {\n  description = "The IBM Cloud platform API key needed to deploy IAM enabled resources."\n  type        = string\n  sensitive   = true\n}\n\nvariable "region" {\n  description = "IBM Cloud Region where resources will be provisioned"\n  type        = string\n  default     = "us-south"\n  validation {\n    error_message = "Region must be in a supported IBM VPC region."\n    condition     = contains(["us-south", "us-east", "br-sao", "ca-tor", "eu-gb", "eu-de", "jp-tok", "jp-osa", "au-syd"], var.region)\n  }\n}\n\nvariable "prefix" {\n  description = "Name prefix that will be prepended to named resources"\n  type        = string\n  default     = "iac"\n  validation {\n    error_message = "Prefix must begin with a lowercase letter and contain only lowercase letters, numbers, and - characters. Prefixes must end with a lowercase letter or number and be 16 or fewer characters."\n    condition     = can(regex("^([a-z]|[a-z][-a-z0-9]*[a-z0-9])", var.prefix)) && length(var.prefix) <= 16\n  }\n}\n\nvariable "ssh_key_public_key" {\n  description = "Public SSH Key Value for SSH Key"\n  type        = string\n  sensitive   = true\n  default     = ""\n  validation {\n    error_message = "Public SSH Key must be a valid ssh rsa public key."\n    condition     = "${var.ssh_key_public_key == null || can(regex("ssh-rsa AAAA[0-9A-Za-z+/]+[=]{0,3} ?([^@]+@[^@]+)?", var.ssh_key_public_key))}"\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/key_management.tf",
          data: '##############################################################################\n# Key Management Instance Kms\n##############################################################################\n\nresource "ibm_resource_instance" "kms" {\n  name              = "${var.prefix}-kms"\n  resource_group_id = ibm_resource_group.service_rg.id\n  service           = "kms"\n  plan              = "tiered-pricing"\n  location          = var.region\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\nresource "ibm_iam_authorization_policy" "kms_server_protect_policy" {\n  source_service_name         = "server-protect"\n  target_service_name         = "kms"\n  target_resource_instance_id = ibm_resource_instance.kms.guid\n  description                 = "Allow block storage volumes to be encrypted by Key Management instance."\n  roles = [\n    "Reader"\n  ]\n}\n\nresource "ibm_iam_authorization_policy" "kms_block_storage_policy" {\n  source_service_name         = "is"\n  target_service_name         = "kms"\n  target_resource_instance_id = ibm_resource_instance.kms.guid\n  description                 = "Allow block storage volumes to be encrypted by Key Management instance."\n  source_resource_type        = "share"\n  roles = [\n    "Reader",\n    "Authorization Delegator"\n  ]\n}\n\nresource "ibm_kms_key_rings" "kms_ring_ring" {\n  key_ring_id = "${var.prefix}-kms-ring"\n  instance_id = ibm_resource_instance.kms.guid\n}\n\nresource "ibm_kms_key" "kms_key_key" {\n  instance_id   = ibm_resource_instance.kms.guid\n  key_name      = "${var.prefix}-kms-key"\n  standard_key  = false\n  key_ring_id   = ibm_kms_key_rings.kms_ring_ring.key_ring_id\n  force_delete  = true\n  endpoint_type = "public"\n  depends_on = [\n    ibm_iam_authorization_policy.kms_server_protect_policy,\n    ibm_iam_authorization_policy.kms_block_storage_policy\n  ]\n}\n\nresource "ibm_kms_key_policies" "kms_key_key_policy" {\n  instance_id   = ibm_resource_instance.kms.guid\n  endpoint_type = "private"\n  key_id        = ibm_kms_key.kms_key_key.key_id\n  rotation {\n    interval_month = 1\n  }\n  dual_auth_delete {\n    enabled = false\n  }\n}\n\nresource "ibm_kms_key" "kms_atracker_key_key" {\n  instance_id   = ibm_resource_instance.kms.guid\n  key_name      = "${var.prefix}-kms-atracker-key"\n  standard_key  = false\n  key_ring_id   = ibm_kms_key_rings.kms_ring_ring.key_ring_id\n  force_delete  = true\n  endpoint_type = "public"\n  depends_on = [\n    ibm_iam_authorization_policy.kms_server_protect_policy,\n    ibm_iam_authorization_policy.kms_block_storage_policy\n  ]\n}\n\nresource "ibm_kms_key_policies" "kms_atracker_key_key_policy" {\n  instance_id   = ibm_resource_instance.kms.guid\n  endpoint_type = "private"\n  key_id        = ibm_kms_key.kms_atracker_key_key.key_id\n  rotation {\n    interval_month = 1\n  }\n  dual_auth_delete {\n    enabled = false\n  }\n}\n\nresource "ibm_kms_key" "kms_vsi_volume_key_key" {\n  instance_id   = ibm_resource_instance.kms.guid\n  key_name      = "${var.prefix}-kms-vsi-volume-key"\n  standard_key  = false\n  key_ring_id   = ibm_kms_key_rings.kms_ring_ring.key_ring_id\n  force_delete  = true\n  endpoint_type = "public"\n  depends_on = [\n    ibm_iam_authorization_policy.kms_server_protect_policy,\n    ibm_iam_authorization_policy.kms_block_storage_policy\n  ]\n}\n\nresource "ibm_kms_key_policies" "kms_vsi_volume_key_key_policy" {\n  instance_id   = ibm_resource_instance.kms.guid\n  endpoint_type = "private"\n  key_id        = ibm_kms_key.kms_vsi_volume_key_key.key_id\n  rotation {\n    interval_month = 1\n  }\n  dual_auth_delete {\n    enabled = false\n  }\n}\n\nresource "ibm_kms_key" "kms_roks_key_key" {\n  instance_id   = ibm_resource_instance.kms.guid\n  key_name      = "${var.prefix}-kms-roks-key"\n  standard_key  = false\n  key_ring_id   = ibm_kms_key_rings.kms_ring_ring.key_ring_id\n  endpoint_type = "private"\n  force_delete  = null\n  depends_on = [\n    ibm_iam_authorization_policy.kms_server_protect_policy,\n    ibm_iam_authorization_policy.kms_block_storage_policy\n  ]\n}\n\nresource "ibm_kms_key_policies" "kms_roks_key_key_policy" {\n  instance_id   = ibm_resource_instance.kms.guid\n  endpoint_type = "private"\n  key_id        = ibm_kms_key.kms_roks_key_key.key_id\n  rotation {\n    interval_month = 1\n  }\n  dual_auth_delete {\n    enabled = false\n  }\n}\n\n##############################################################################\n\n',
        },
        {
          name: "craig/object_storage.tf",
          data: '##############################################################################\n# Object Storage Instance Atracker Cos\n##############################################################################\n\nresource "random_string" "atracker_cos_random_suffix" {\n  length  = 8\n  special = false\n  upper   = false\n}\n\nresource "ibm_resource_instance" "atracker_cos_object_storage" {\n  name              = "${var.prefix}-atracker-cos-object-storage-${random_string.atracker_cos_random_suffix.result}"\n  resource_group_id = ibm_resource_group.service_rg.id\n  service           = "cloud-object-storage"\n  location          = "global"\n  plan              = "standard"\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\nresource "ibm_iam_authorization_policy" "atracker_cos_cos_to_kms_kms_policy" {\n  source_service_name         = "cloud-object-storage"\n  source_resource_instance_id = ibm_resource_instance.atracker_cos_object_storage.guid\n  description                 = "Allow COS instance to read from KMS instance"\n  target_service_name         = "kms"\n  target_resource_instance_id = ibm_resource_instance.kms.guid\n  roles = [\n    "Reader"\n  ]\n}\n\nresource "ibm_cos_bucket" "atracker_cos_object_storage_atracker_bucket_bucket" {\n  bucket_name          = "${var.prefix}-atracker-cos-atracker-bucket-${random_string.atracker_cos_random_suffix.result}"\n  resource_instance_id = ibm_resource_instance.atracker_cos_object_storage.id\n  storage_class        = "standard"\n  endpoint_type        = "private"\n  force_delete         = true\n  region_location      = var.region\n  key_protect          = ibm_kms_key.kms_atracker_key_key.crn\n  depends_on = [\n    ibm_iam_authorization_policy.atracker_cos_cos_to_kms_kms_policy\n  ]\n}\n\nresource "ibm_resource_key" "atracker_cos_object_storage_key_cos_bind_key" {\n  name                 = "${var.prefix}-atracker-cos-key-cos-bind-key-${random_string.atracker_cos_random_suffix.result}"\n  resource_instance_id = ibm_resource_instance.atracker_cos_object_storage.id\n  role                 = "Writer"\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\n##############################################################################\n\n##############################################################################\n# Object Storage Instance Cos\n##############################################################################\n\nresource "random_string" "cos_random_suffix" {\n  length  = 8\n  special = false\n  upper   = false\n}\n\nresource "ibm_resource_instance" "cos_object_storage" {\n  name              = "${var.prefix}-cos-object-storage-${random_string.cos_random_suffix.result}"\n  resource_group_id = ibm_resource_group.service_rg.id\n  service           = "cloud-object-storage"\n  location          = "global"\n  plan              = "standard"\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\nresource "ibm_iam_authorization_policy" "cos_cos_to_kms_kms_policy" {\n  source_service_name         = "cloud-object-storage"\n  source_resource_instance_id = ibm_resource_instance.cos_object_storage.guid\n  description                 = "Allow COS instance to read from KMS instance"\n  target_service_name         = "kms"\n  target_resource_instance_id = ibm_resource_instance.kms.guid\n  roles = [\n    "Reader"\n  ]\n}\n\nresource "ibm_cos_bucket" "cos_object_storage_management_bucket_bucket" {\n  bucket_name          = "${var.prefix}-cos-management-bucket-${random_string.cos_random_suffix.result}"\n  resource_instance_id = ibm_resource_instance.cos_object_storage.id\n  storage_class        = "standard"\n  endpoint_type        = "private"\n  force_delete         = true\n  region_location      = var.region\n  key_protect          = ibm_kms_key.kms_key_key.crn\n  depends_on = [\n    ibm_iam_authorization_policy.cos_cos_to_kms_kms_policy\n  ]\n}\n\nresource "ibm_cos_bucket" "cos_object_storage_workload_bucket_bucket" {\n  bucket_name          = "${var.prefix}-cos-workload-bucket-${random_string.cos_random_suffix.result}"\n  resource_instance_id = ibm_resource_instance.cos_object_storage.id\n  storage_class        = "standard"\n  endpoint_type        = "private"\n  force_delete         = true\n  region_location      = var.region\n  key_protect          = ibm_kms_key.kms_key_key.crn\n  depends_on = [\n    ibm_iam_authorization_policy.cos_cos_to_kms_kms_policy\n  ]\n}\n\n##############################################################################\n\n',
        },
        {
          name: "craig/resource_groups.tf",
          data: '##############################################################################\n# Resource Groups\n##############################################################################\n\nresource "ibm_resource_group" "service_rg" {\n  name = "${var.prefix}-service-rg"\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\nresource "ibm_resource_group" "management_rg" {\n  name = "${var.prefix}-management-rg"\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\nresource "ibm_resource_group" "workload_rg" {\n  name = "${var.prefix}-workload-rg"\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/versions.tf",
          data: '##############################################################################\n# Terraform Providers\n##############################################################################\n\nterraform {\n  required_providers {\n    ibm = {\n      source  = "IBM-Cloud/ibm"\n      version = "~>1.56.1"\n    }\n  }\n  required_version = ">=1.3"\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/ssh_keys.tf",
          data: '##############################################################################\n# SSH Keys\n##############################################################################\n\nresource "ibm_is_ssh_key" "ssh_key" {\n  name           = "${var.prefix}-ssh-key"\n  public_key     = var.ssh_key_public_key\n  resource_group = ibm_resource_group.management_rg.id\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/atracker.tf",
          data: '##############################################################################\n# Atracker Resources\n##############################################################################\n\nresource "ibm_atracker_target" "atracker_cos_target" {\n  name        = "${var.prefix}-atracker-cos"\n  region      = var.region\n  target_type = "cloud_object_storage"\n  cos_endpoint {\n    endpoint   = "s3.private.${var.region}.cloud-object-storage.appdomain.cloud"\n    target_crn = ibm_resource_instance.atracker_cos_object_storage.id\n    bucket     = ibm_cos_bucket.atracker_cos_object_storage_atracker_bucket_bucket.bucket_name\n    api_key    = ibm_resource_key.atracker_cos_object_storage_key_cos_bind_key.credentials.apikey\n  }\n}\n\nresource "ibm_atracker_route" "atracker_cos_route" {\n  name = "${var.prefix}-atracker-cos-route"\n  rules {\n    locations = [\n      "global",\n      var.region\n    ]\n    target_ids = [\n      ibm_atracker_target.atracker_cos_target.id\n    ]\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/craig.json",
          data: '{\n  "_options": {\n    "prefix": "iac",\n    "region": "us-south",\n    "tags": [\n      "hello",\n      "world"\n    ],\n    "zones": 3,\n    "endpoints": "private",\n    "account_id": "",\n    "fs_cloud": false,\n    "dynamic_subnets": true,\n    "enable_power_vs": false,\n    "power_vs_zones": [],\n    "craig_version": "1.4.0"\n  },\n  "access_groups": [],\n  "appid": [],\n  "atracker": {\n    "enabled": true,\n    "type": "cos",\n    "name": "atracker",\n    "target_name": "atracker-cos",\n    "bucket": "atracker-bucket",\n    "add_route": true,\n    "cos_key": "cos-bind-key",\n    "locations": [\n      "global",\n      "us-south"\n    ]\n  },\n  "cbr_rules": [],\n  "cbr_zones": [],\n  "clusters": [\n    {\n      "kms": "kms",\n      "cos": "cos",\n      "entitlement": "cloud_pak",\n      "kube_type": "openshift",\n      "kube_version": "4.12.26_openshift",\n      "flavor": "bx2.16x64",\n      "name": "workload-cluster",\n      "resource_group": "workload-rg",\n      "encryption_key": "roks-key",\n      "subnets": [\n        "vsi-zone-1",\n        "vsi-zone-2",\n        "vsi-zone-3"\n      ],\n      "update_all_workers": false,\n      "vpc": "workload",\n      "worker_pools": [\n        {\n          "entitlement": "cloud_pak",\n          "cluster": "workload-cluster",\n          "flavor": "bx2.16x64",\n          "name": "logging-worker-pool",\n          "resource_group": "workload-rg",\n          "subnets": [\n            "vsi-zone-1",\n            "vsi-zone-2",\n            "vsi-zone-3"\n          ],\n          "vpc": "workload",\n          "workers_per_subnet": 2\n        }\n      ],\n      "opaque_secrets": [],\n      "workers_per_subnet": 2,\n      "private_endpoint": true\n    }\n  ],\n  "dns": [],\n  "event_streams": [],\n  "f5_vsi": [],\n  "iam_account_settings": {\n    "enable": false,\n    "mfa": null,\n    "allowed_ip_addresses": null,\n    "include_history": false,\n    "if_match": null,\n    "max_sessions_per_identity": null,\n    "restrict_create_service_id": null,\n    "restrict_create_platform_apikey": null,\n    "session_expiration_in_seconds": null,\n    "session_invalidation_in_seconds": null\n  },\n  "icd": [],\n  "key_management": [\n    {\n      "name": "kms",\n      "resource_group": "service-rg",\n      "use_hs_crypto": false,\n      "authorize_vpc_reader_role": true,\n      "use_data": false,\n      "keys": [\n        {\n          "key_ring": "ring",\n          "name": "key",\n          "root_key": true,\n          "force_delete": true,\n          "endpoint": "public",\n          "rotation": 1,\n          "dual_auth_delete": false\n        },\n        {\n          "key_ring": "ring",\n          "name": "atracker-key",\n          "root_key": true,\n          "force_delete": true,\n          "endpoint": "public",\n          "rotation": 1,\n          "dual_auth_delete": false\n        },\n        {\n          "key_ring": "ring",\n          "name": "vsi-volume-key",\n          "root_key": true,\n          "force_delete": true,\n          "endpoint": "public",\n          "rotation": 1,\n          "dual_auth_delete": false\n        },\n        {\n          "key_ring": "ring",\n          "name": "roks-key",\n          "root_key": true,\n          "force_delete": null,\n          "endpoint": null,\n          "rotation": 1,\n          "dual_auth_delete": false\n        }\n      ]\n    }\n  ],\n  "load_balancers": [],\n  "logdna": {\n    "enabled": false,\n    "plan": "lite",\n    "endpoints": "private",\n    "platform_logs": false,\n    "resource_group": "service-rg",\n    "cos": "atracker-cos",\n    "bucket": "atracker-bucket"\n  },\n  "object_storage": [\n    {\n      "buckets": [\n        {\n          "endpoint": "public",\n          "force_delete": true,\n          "kms_key": "atracker-key",\n          "name": "atracker-bucket",\n          "storage_class": "standard",\n          "use_random_suffix": true\n        }\n      ],\n      "keys": [\n        {\n          "name": "cos-bind-key",\n          "role": "Writer",\n          "enable_hmac": false,\n          "use_random_suffix": true\n        }\n      ],\n      "name": "atracker-cos",\n      "plan": "standard",\n      "resource_group": "service-rg",\n      "use_data": false,\n      "use_random_suffix": true,\n      "kms": "kms"\n    },\n    {\n      "buckets": [\n        {\n          "endpoint": "public",\n          "force_delete": true,\n          "kms_key": "key",\n          "name": "management-bucket",\n          "storage_class": "standard",\n          "use_random_suffix": true\n        },\n        {\n          "endpoint": "public",\n          "force_delete": true,\n          "kms_key": "key",\n          "name": "workload-bucket",\n          "storage_class": "standard",\n          "use_random_suffix": true\n        }\n      ],\n      "use_random_suffix": true,\n      "keys": [],\n      "name": "cos",\n      "plan": "standard",\n      "resource_group": "service-rg",\n      "use_data": false,\n      "kms": "kms"\n    }\n  ],\n  "power": [],\n  "power_instances": [],\n  "power_volumes": [],\n  "resource_groups": [\n    {\n      "use_prefix": true,\n      "name": "service-rg",\n      "use_data": false\n    },\n    {\n      "use_prefix": true,\n      "name": "management-rg",\n      "use_data": false\n    },\n    {\n      "use_prefix": true,\n      "name": "workload-rg",\n      "use_data": false\n    }\n  ],\n  "routing_tables": [],\n  "scc": {\n    "credential_description": null,\n    "id": null,\n    "passphrase": null,\n    "name": "",\n    "location": "us",\n    "collector_description": null,\n    "is_public": false,\n    "scope_description": null,\n    "enable": false\n  },\n  "secrets_manager": [],\n  "security_groups": [\n    {\n      "vpc": "management",\n      "name": "management-vpe",\n      "resource_group": "management-rg",\n      "rules": [\n        {\n          "vpc": "management",\n          "sg": "management-vpe",\n          "direction": "inbound",\n          "name": "allow-ibm-inbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vpe",\n          "direction": "inbound",\n          "name": "allow-vpc-inbound",\n          "source": "10.0.0.0/8",\n          "tcp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vpe",\n          "direction": "outbound",\n          "name": "allow-vpc-outbound",\n          "source": "10.0.0.0/8",\n          "tcp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vpe",\n          "direction": "outbound",\n          "name": "allow-ibm-tcp-53-outbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": 53,\n            "port_min": 53\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vpe",\n          "direction": "outbound",\n          "name": "allow-ibm-tcp-80-outbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": 80,\n            "port_min": 80\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vpe",\n          "direction": "outbound",\n          "name": "allow-ibm-tcp-443-outbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": 443,\n            "port_min": 443\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        }\n      ]\n    },\n    {\n      "vpc": "workload",\n      "name": "workload-vpe",\n      "resource_group": "workload-rg",\n      "rules": [\n        {\n          "vpc": "workload",\n          "sg": "workload-vpe",\n          "direction": "inbound",\n          "name": "allow-ibm-inbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "workload",\n          "sg": "workload-vpe",\n          "direction": "inbound",\n          "name": "allow-vpc-inbound",\n          "source": "10.0.0.0/8",\n          "tcp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "workload",\n          "sg": "workload-vpe",\n          "direction": "outbound",\n          "name": "allow-vpc-outbound",\n          "source": "10.0.0.0/8",\n          "tcp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "workload",\n          "sg": "workload-vpe",\n          "direction": "outbound",\n          "name": "allow-ibm-tcp-53-outbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": 53,\n            "port_min": 53\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "workload",\n          "sg": "workload-vpe",\n          "direction": "outbound",\n          "name": "allow-ibm-tcp-80-outbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": 80,\n            "port_min": 80\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "workload",\n          "sg": "workload-vpe",\n          "direction": "outbound",\n          "name": "allow-ibm-tcp-443-outbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": 443,\n            "port_min": 443\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        }\n      ]\n    },\n    {\n      "vpc": "management",\n      "name": "management-vsi",\n      "resource_group": "management-rg",\n      "rules": [\n        {\n          "vpc": "management",\n          "sg": "management-vsi",\n          "direction": "inbound",\n          "name": "allow-ibm-inbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vsi",\n          "direction": "inbound",\n          "name": "allow-vpc-inbound",\n          "source": "10.0.0.0/8",\n          "tcp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vsi",\n          "direction": "outbound",\n          "name": "allow-vpc-outbound",\n          "source": "10.0.0.0/8",\n          "tcp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vsi",\n          "direction": "outbound",\n          "name": "allow-ibm-tcp-53-outbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": 53,\n            "port_min": 53\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vsi",\n          "direction": "outbound",\n          "name": "allow-ibm-tcp-80-outbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": 80,\n            "port_min": 80\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        },\n        {\n          "vpc": "management",\n          "sg": "management-vsi",\n          "direction": "outbound",\n          "name": "allow-ibm-tcp-443-outbound",\n          "source": "161.26.0.0/16",\n          "tcp": {\n            "port_max": 443,\n            "port_min": 443\n          },\n          "udp": {\n            "port_max": null,\n            "port_min": null\n          },\n          "icmp": {\n            "type": null,\n            "code": null\n          }\n        }\n      ]\n    }\n  ],\n  "ssh_keys": [\n    {\n      "name": "ssh-key",\n      "public_key": "",\n      "resource_group": "management-rg",\n      "use_data": false\n    }\n  ],\n  "sysdig": {\n    "enabled": false,\n    "plan": "graduated-tier",\n    "resource_group": "service-rg"\n  },\n  "teleport_vsi": [],\n  "transit_gateways": [\n    {\n      "name": "transit-gateway",\n      "resource_group": "service-rg",\n      "global": false,\n      "connections": [\n        {\n          "tgw": "transit-gateway",\n          "vpc": "management"\n        },\n        {\n          "tgw": "transit-gateway",\n          "vpc": "workload"\n        }\n      ]\n    }\n  ],\n  "virtual_private_endpoints": [\n    {\n      "name": "management-cos",\n      "service": "cos",\n      "vpc": "management",\n      "resource_group": "management-rg",\n      "security_groups": [\n        "management-vpe"\n      ],\n      "subnets": [\n        "vpe-zone-1",\n        "vpe-zone-2",\n        "vpe-zone-3"\n      ]\n    },\n    {\n      "name": "workload-cos",\n      "service": "cos",\n      "vpc": "workload",\n      "resource_group": "workload-rg",\n      "security_groups": [\n        "workload-vpe"\n      ],\n      "subnets": [\n        "vpe-zone-1",\n        "vpe-zone-2",\n        "vpe-zone-3"\n      ]\n    }\n  ],\n  "vpcs": [\n    {\n      "cos": "cos",\n      "bucket": "management-bucket",\n      "name": "management",\n      "resource_group": "management-rg",\n      "classic_access": false,\n      "manual_address_prefix_management": true,\n      "default_network_acl_name": null,\n      "default_security_group_name": null,\n      "default_routing_table_name": null,\n      "publicGateways": [],\n      "address_prefixes": [\n        {\n          "vpc": "management",\n          "zone": 1,\n          "name": "management-zone-1",\n          "cidr": "10.10.0.0/22"\n        },\n        {\n          "vpc": "management",\n          "zone": 2,\n          "name": "management-zone-2",\n          "cidr": "10.20.0.0/22"\n        },\n        {\n          "vpc": "management",\n          "zone": 3,\n          "name": "management-zone-3",\n          "cidr": "10.30.0.0/22"\n        }\n      ],\n      "subnets": [\n        {\n          "vpc": "management",\n          "zone": 1,\n          "cidr": "10.10.0.0/29",\n          "name": "vsi-zone-1",\n          "network_acl": "management",\n          "resource_group": "management-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "management",\n          "zone": 1,\n          "cidr": "10.10.0.16/28",\n          "name": "vpn-zone-1",\n          "network_acl": "management",\n          "resource_group": "management-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "management",\n          "zone": 2,\n          "cidr": "10.20.0.0/29",\n          "name": "vsi-zone-2",\n          "network_acl": "management",\n          "resource_group": "management-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "management",\n          "zone": 3,\n          "cidr": "10.30.0.0/29",\n          "name": "vsi-zone-3",\n          "network_acl": "management",\n          "resource_group": "management-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "management",\n          "zone": 1,\n          "cidr": "10.10.0.48/29",\n          "name": "vpe-zone-1",\n          "resource_group": "management-rg",\n          "network_acl": "management",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "management",\n          "zone": 2,\n          "cidr": "10.20.0.16/29",\n          "name": "vpe-zone-2",\n          "network_acl": "management",\n          "resource_group": "management-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "management",\n          "zone": 3,\n          "cidr": "10.30.0.16/29",\n          "name": "vpe-zone-3",\n          "network_acl": "management",\n          "resource_group": "management-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        }\n      ],\n      "public_gateways": [],\n      "acls": [\n        {\n          "resource_group": "management-rg",\n          "name": "management",\n          "vpc": "management",\n          "rules": [\n            {\n              "action": "allow",\n              "destination": "10.0.0.0/8",\n              "direction": "inbound",\n              "name": "allow-ibm-inbound",\n              "source": "161.26.0.0/16",\n              "acl": "management",\n              "vpc": "management",\n              "icmp": {\n                "type": null,\n                "code": null\n              },\n              "tcp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              },\n              "udp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              }\n            },\n            {\n              "action": "allow",\n              "source": "10.0.0.0/8",\n              "direction": "outbound",\n              "name": "allow-ibm-outbound",\n              "destination": "161.26.0.0/16",\n              "acl": "management",\n              "vpc": "management",\n              "icmp": {\n                "type": null,\n                "code": null\n              },\n              "tcp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              },\n              "udp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              }\n            },\n            {\n              "action": "allow",\n              "destination": "10.0.0.0/8",\n              "direction": "inbound",\n              "name": "allow-all-network-inbound",\n              "source": "10.0.0.0/8",\n              "acl": "management",\n              "vpc": "management",\n              "icmp": {\n                "type": null,\n                "code": null\n              },\n              "tcp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              },\n              "udp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              }\n            },\n            {\n              "action": "allow",\n              "destination": "10.0.0.0/8",\n              "direction": "outbound",\n              "name": "allow-all-network-outbound",\n              "source": "10.0.0.0/8",\n              "acl": "management",\n              "vpc": "management",\n              "icmp": {\n                "type": null,\n                "code": null\n              },\n              "tcp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              },\n              "udp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              }\n            }\n          ]\n        }\n      ]\n    },\n    {\n      "cos": "cos",\n      "bucket": "workload-bucket",\n      "name": "workload",\n      "resource_group": "workload-rg",\n      "classic_access": false,\n      "manual_address_prefix_management": true,\n      "default_network_acl_name": null,\n      "default_security_group_name": null,\n      "default_routing_table_name": null,\n      "publicGateways": [],\n      "address_prefixes": [\n        {\n          "vpc": "workload",\n          "zone": 1,\n          "name": "workload-zone-1",\n          "cidr": "10.40.0.0/22"\n        },\n        {\n          "vpc": "workload",\n          "zone": 2,\n          "name": "workload-zone-2",\n          "cidr": "10.50.0.0/22"\n        },\n        {\n          "vpc": "workload",\n          "zone": 3,\n          "name": "workload-zone-3",\n          "cidr": "10.60.0.0/22"\n        }\n      ],\n      "subnets": [\n        {\n          "vpc": "workload",\n          "zone": 1,\n          "cidr": "10.40.0.0/28",\n          "name": "vsi-zone-1",\n          "network_acl": "workload",\n          "resource_group": "workload-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "workload",\n          "zone": 2,\n          "cidr": "10.50.0.0/28",\n          "name": "vsi-zone-2",\n          "network_acl": "workload",\n          "resource_group": "workload-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "workload",\n          "zone": 3,\n          "cidr": "10.60.0.0/28",\n          "name": "vsi-zone-3",\n          "network_acl": "workload",\n          "resource_group": "workload-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "workload",\n          "zone": 1,\n          "cidr": "10.40.0.32/29",\n          "name": "vpe-zone-1",\n          "network_acl": "workload",\n          "resource_group": "workload-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "workload",\n          "zone": 2,\n          "cidr": "10.50.0.32/29",\n          "name": "vpe-zone-2",\n          "network_acl": "workload",\n          "resource_group": "workload-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        },\n        {\n          "vpc": "workload",\n          "zone": 3,\n          "cidr": "10.60.0.32/29",\n          "name": "vpe-zone-3",\n          "network_acl": "workload",\n          "resource_group": "workload-rg",\n          "public_gateway": false,\n          "has_prefix": false\n        }\n      ],\n      "public_gateways": [],\n      "acls": [\n        {\n          "resource_group": "workload-rg",\n          "name": "workload",\n          "vpc": "workload",\n          "rules": [\n            {\n              "action": "allow",\n              "destination": "10.0.0.0/8",\n              "direction": "inbound",\n              "name": "allow-ibm-inbound",\n              "source": "161.26.0.0/16",\n              "acl": "workload",\n              "vpc": "workload",\n              "icmp": {\n                "type": null,\n                "code": null\n              },\n              "tcp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              },\n              "udp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              }\n            },\n            {\n              "action": "allow",\n              "source": "10.0.0.0/8",\n              "direction": "outbound",\n              "name": "allow-ibm-outbound",\n              "destination": "161.26.0.0/16",\n              "acl": "workload",\n              "vpc": "workload",\n              "icmp": {\n                "type": null,\n                "code": null\n              },\n              "tcp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              },\n              "udp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              }\n            },\n            {\n              "action": "allow",\n              "destination": "10.0.0.0/8",\n              "direction": "inbound",\n              "name": "allow-all-network-inbound",\n              "source": "10.0.0.0/8",\n              "acl": "workload",\n              "vpc": "workload",\n              "icmp": {\n                "type": null,\n                "code": null\n              },\n              "tcp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              },\n              "udp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              }\n            },\n            {\n              "action": "allow",\n              "destination": "10.0.0.0/8",\n              "direction": "outbound",\n              "name": "allow-all-network-outbound",\n              "source": "10.0.0.0/8",\n              "acl": "workload",\n              "vpc": "workload",\n              "icmp": {\n                "type": null,\n                "code": null\n              },\n              "tcp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              },\n              "udp": {\n                "port_min": null,\n                "port_max": null,\n                "source_port_min": null,\n                "source_port_max": null\n              }\n            }\n          ]\n        }\n      ]\n    }\n  ],\n  "vpn_gateways": [\n    {\n      "name": "management-gateway",\n      "resource_group": "management-rg",\n      "subnet": "vpn-zone-1",\n      "vpc": "management"\n    }\n  ],\n  "vpn_servers": [],\n  "vsi": [\n    {\n      "kms": "kms",\n      "encryption_key": "vsi-volume-key",\n      "image": "ibm-ubuntu-22-04-1-minimal-amd64-1",\n      "profile": "cx2-4x8",\n      "name": "management-server",\n      "security_groups": [\n        "management-vsi"\n      ],\n      "ssh_keys": [\n        "ssh-key"\n      ],\n      "subnets": [\n        "vsi-zone-1",\n        "vsi-zone-2",\n        "vsi-zone-3"\n      ],\n      "vpc": "management",\n      "vsi_per_subnet": 2,\n      "resource_group": "management-rg",\n      "override_vsi_name": null,\n      "user_data": "",\n      "network_interfaces": [],\n      "volumes": []\n    }\n  ]\n}',
        },
        { name: "craig/management_vpc", data: "" },
        { name: "craig/management_vpc", data: "" },
        {
          name: "craig/management_vpc/main.tf",
          data: '##############################################################################\n# Management VPC\n##############################################################################\n\nresource "ibm_is_vpc" "management_vpc" {\n  name                        = "${var.prefix}-management-vpc"\n  resource_group              = var.management_rg_id\n  tags                        = var.tags\n  address_prefix_management   = "manual"\n  default_network_acl_name    = null\n  default_security_group_name = null\n  default_routing_table_name  = null\n}\n\nresource "ibm_is_vpc_address_prefix" "management_management_zone_1_prefix" {\n  name = "${var.prefix}-management-management-zone-1"\n  vpc  = ibm_is_vpc.management_vpc.id\n  zone = "${var.region}-1"\n  cidr = "10.10.0.0/22"\n}\n\nresource "ibm_is_vpc_address_prefix" "management_management_zone_2_prefix" {\n  name = "${var.prefix}-management-management-zone-2"\n  vpc  = ibm_is_vpc.management_vpc.id\n  zone = "${var.region}-2"\n  cidr = "10.20.0.0/22"\n}\n\nresource "ibm_is_vpc_address_prefix" "management_management_zone_3_prefix" {\n  name = "${var.prefix}-management-management-zone-3"\n  vpc  = ibm_is_vpc.management_vpc.id\n  zone = "${var.region}-3"\n  cidr = "10.30.0.0/22"\n}\n\nresource "ibm_is_subnet" "management_vsi_zone_1" {\n  vpc             = ibm_is_vpc.management_vpc.id\n  name            = "${var.prefix}-management-vsi-zone-1"\n  zone            = "${var.region}-1"\n  resource_group  = var.management_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.management_management_acl.id\n  ipv4_cidr_block = "10.10.0.0/29"\n  depends_on = [\n    ibm_is_vpc_address_prefix.management_management_zone_1_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "management_vpn_zone_1" {\n  vpc             = ibm_is_vpc.management_vpc.id\n  name            = "${var.prefix}-management-vpn-zone-1"\n  zone            = "${var.region}-1"\n  resource_group  = var.management_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.management_management_acl.id\n  ipv4_cidr_block = "10.10.0.16/28"\n  depends_on = [\n    ibm_is_vpc_address_prefix.management_management_zone_1_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "management_vsi_zone_2" {\n  vpc             = ibm_is_vpc.management_vpc.id\n  name            = "${var.prefix}-management-vsi-zone-2"\n  zone            = "${var.region}-2"\n  resource_group  = var.management_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.management_management_acl.id\n  ipv4_cidr_block = "10.20.0.0/29"\n  depends_on = [\n    ibm_is_vpc_address_prefix.management_management_zone_2_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "management_vsi_zone_3" {\n  vpc             = ibm_is_vpc.management_vpc.id\n  name            = "${var.prefix}-management-vsi-zone-3"\n  zone            = "${var.region}-3"\n  resource_group  = var.management_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.management_management_acl.id\n  ipv4_cidr_block = "10.30.0.0/29"\n  depends_on = [\n    ibm_is_vpc_address_prefix.management_management_zone_3_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "management_vpe_zone_1" {\n  vpc             = ibm_is_vpc.management_vpc.id\n  name            = "${var.prefix}-management-vpe-zone-1"\n  zone            = "${var.region}-1"\n  resource_group  = var.management_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.management_management_acl.id\n  ipv4_cidr_block = "10.10.0.48/29"\n  depends_on = [\n    ibm_is_vpc_address_prefix.management_management_zone_1_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "management_vpe_zone_2" {\n  vpc             = ibm_is_vpc.management_vpc.id\n  name            = "${var.prefix}-management-vpe-zone-2"\n  zone            = "${var.region}-2"\n  resource_group  = var.management_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.management_management_acl.id\n  ipv4_cidr_block = "10.20.0.16/29"\n  depends_on = [\n    ibm_is_vpc_address_prefix.management_management_zone_2_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "management_vpe_zone_3" {\n  vpc             = ibm_is_vpc.management_vpc.id\n  name            = "${var.prefix}-management-vpe-zone-3"\n  zone            = "${var.region}-3"\n  resource_group  = var.management_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.management_management_acl.id\n  ipv4_cidr_block = "10.30.0.16/29"\n  depends_on = [\n    ibm_is_vpc_address_prefix.management_management_zone_3_prefix\n  ]\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/management_vpc/versions.tf",
          data: '##############################################################################\n# Terraform Providers\n##############################################################################\n\nterraform {\n  required_providers {\n    ibm = {\n      source  = "IBM-Cloud/ibm"\n      version = "~>1.56.1"\n    }\n  }\n  required_version = ">=1.3"\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/management_vpc/variables.tf",
          data: '##############################################################################\n# Management VPC Variables\n##############################################################################\n\nvariable "tags" {\n  description = "List of tags"\n  type        = list(string)\n}\n\nvariable "region" {\n  description = "IBM Cloud Region where resources will be provisioned"\n  type        = string\n  validation {\n    error_message = "Region must be in a supported IBM VPC region."\n    condition     = contains(["us-south", "us-east", "br-sao", "ca-tor", "eu-gb", "eu-de", "jp-tok", "jp-osa", "au-syd"], var.region)\n  }\n}\n\nvariable "prefix" {\n  description = "Name prefix that will be prepended to named resources"\n  type        = string\n  validation {\n    error_message = "Prefix must begin with a lowercase letter and contain only lowercase letters, numbers, and - characters. Prefixes must end with a lowercase letter or number and be 16 or fewer characters."\n    condition     = can(regex("^([a-z]|[a-z][-a-z0-9]*[a-z0-9])", var.prefix)) && length(var.prefix) <= 16\n  }\n}\n\nvariable "management_rg_id" {\n  description = "ID for the resource group management-rg"\n  type        = string\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/management_vpc/acl_management_management.tf",
          data: '##############################################################################\n# Management Management ACL\n##############################################################################\n\nresource "ibm_is_network_acl" "management_management_acl" {\n  name           = "${var.prefix}-management-management-acl"\n  vpc            = ibm_is_vpc.management_vpc.id\n  resource_group = var.management_rg_id\n  tags = [\n    "hello",\n    "world"\n  ]\n  rules {\n    source      = "161.26.0.0/16"\n    action      = "allow"\n    destination = "10.0.0.0/8"\n    direction   = "inbound"\n    name        = "allow-ibm-inbound"\n  }\n  rules {\n    source      = "10.0.0.0/8"\n    action      = "allow"\n    destination = "161.26.0.0/16"\n    direction   = "outbound"\n    name        = "allow-ibm-outbound"\n  }\n  rules {\n    source      = "10.0.0.0/8"\n    action      = "allow"\n    destination = "10.0.0.0/8"\n    direction   = "inbound"\n    name        = "allow-all-network-inbound"\n  }\n  rules {\n    source      = "10.0.0.0/8"\n    action      = "allow"\n    destination = "10.0.0.0/8"\n    direction   = "outbound"\n    name        = "allow-all-network-outbound"\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/management_vpc/sg_management_vpe.tf",
          data: '##############################################################################\n# Security Group Management VPE\n##############################################################################\n\nresource "ibm_is_security_group" "management_vpc_management_vpe_sg" {\n  name           = "${var.prefix}-management-management-vpe-sg"\n  vpc            = ibm_is_vpc.management_vpc.id\n  resource_group = var.management_rg_id\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vpe_sg_rule_allow_ibm_inbound" {\n  group     = ibm_is_security_group.management_vpc_management_vpe_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "inbound"\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vpe_sg_rule_allow_vpc_inbound" {\n  group     = ibm_is_security_group.management_vpc_management_vpe_sg.id\n  remote    = "10.0.0.0/8"\n  direction = "inbound"\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vpe_sg_rule_allow_vpc_outbound" {\n  group     = ibm_is_security_group.management_vpc_management_vpe_sg.id\n  remote    = "10.0.0.0/8"\n  direction = "outbound"\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vpe_sg_rule_allow_ibm_tcp_53_outbound" {\n  group     = ibm_is_security_group.management_vpc_management_vpe_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "outbound"\n  tcp {\n    port_min = 53\n    port_max = 53\n  }\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vpe_sg_rule_allow_ibm_tcp_80_outbound" {\n  group     = ibm_is_security_group.management_vpc_management_vpe_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "outbound"\n  tcp {\n    port_min = 80\n    port_max = 80\n  }\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vpe_sg_rule_allow_ibm_tcp_443_outbound" {\n  group     = ibm_is_security_group.management_vpc_management_vpe_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "outbound"\n  tcp {\n    port_min = 443\n    port_max = 443\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/management_vpc/sg_management_vsi.tf",
          data: '##############################################################################\n# Security Group Management VSI\n##############################################################################\n\nresource "ibm_is_security_group" "management_vpc_management_vsi_sg" {\n  name           = "${var.prefix}-management-management-vsi-sg"\n  vpc            = ibm_is_vpc.management_vpc.id\n  resource_group = var.management_rg_id\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vsi_sg_rule_allow_ibm_inbound" {\n  group     = ibm_is_security_group.management_vpc_management_vsi_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "inbound"\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vsi_sg_rule_allow_vpc_inbound" {\n  group     = ibm_is_security_group.management_vpc_management_vsi_sg.id\n  remote    = "10.0.0.0/8"\n  direction = "inbound"\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vsi_sg_rule_allow_vpc_outbound" {\n  group     = ibm_is_security_group.management_vpc_management_vsi_sg.id\n  remote    = "10.0.0.0/8"\n  direction = "outbound"\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vsi_sg_rule_allow_ibm_tcp_53_outbound" {\n  group     = ibm_is_security_group.management_vpc_management_vsi_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "outbound"\n  tcp {\n    port_min = 53\n    port_max = 53\n  }\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vsi_sg_rule_allow_ibm_tcp_80_outbound" {\n  group     = ibm_is_security_group.management_vpc_management_vsi_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "outbound"\n  tcp {\n    port_min = 80\n    port_max = 80\n  }\n}\n\nresource "ibm_is_security_group_rule" "management_vpc_management_vsi_sg_rule_allow_ibm_tcp_443_outbound" {\n  group     = ibm_is_security_group.management_vpc_management_vsi_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "outbound"\n  tcp {\n    port_min = 443\n    port_max = 443\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/management_vpc/outputs.tf",
          data: '##############################################################################\n# Management VPC Outputs\n##############################################################################\n\noutput "id" {\n  value = ibm_is_vpc.management_vpc.id\n}\n\noutput "crn" {\n  value = ibm_is_vpc.management_vpc.crn\n}\n\noutput "vsi_zone_1_id" {\n  value = ibm_is_subnet.management_vsi_zone_1.id\n}\n\noutput "vsi_zone_1_crn" {\n  value = ibm_is_subnet.management_vsi_zone_1.crn\n}\n\noutput "vpn_zone_1_id" {\n  value = ibm_is_subnet.management_vpn_zone_1.id\n}\n\noutput "vpn_zone_1_crn" {\n  value = ibm_is_subnet.management_vpn_zone_1.crn\n}\n\noutput "vsi_zone_2_id" {\n  value = ibm_is_subnet.management_vsi_zone_2.id\n}\n\noutput "vsi_zone_2_crn" {\n  value = ibm_is_subnet.management_vsi_zone_2.crn\n}\n\noutput "vsi_zone_3_id" {\n  value = ibm_is_subnet.management_vsi_zone_3.id\n}\n\noutput "vsi_zone_3_crn" {\n  value = ibm_is_subnet.management_vsi_zone_3.crn\n}\n\noutput "vpe_zone_1_id" {\n  value = ibm_is_subnet.management_vpe_zone_1.id\n}\n\noutput "vpe_zone_1_crn" {\n  value = ibm_is_subnet.management_vpe_zone_1.crn\n}\n\noutput "vpe_zone_2_id" {\n  value = ibm_is_subnet.management_vpe_zone_2.id\n}\n\noutput "vpe_zone_2_crn" {\n  value = ibm_is_subnet.management_vpe_zone_2.crn\n}\n\noutput "vpe_zone_3_id" {\n  value = ibm_is_subnet.management_vpe_zone_3.id\n}\n\noutput "vpe_zone_3_crn" {\n  value = ibm_is_subnet.management_vpe_zone_3.crn\n}\n\noutput "management_vpe_id" {\n  value = ibm_is_security_group.management_vpc_management_vpe_sg.id\n}\n\noutput "management_vsi_id" {\n  value = ibm_is_security_group.management_vpc_management_vsi_sg.id\n}\n\n##############################################################################\n',
        },
        { name: "craig/workload_vpc", data: "" },
        { name: "craig/workload_vpc", data: "" },
        {
          name: "craig/workload_vpc/main.tf",
          data: '##############################################################################\n# Workload VPC\n##############################################################################\n\nresource "ibm_is_vpc" "workload_vpc" {\n  name                        = "${var.prefix}-workload-vpc"\n  resource_group              = var.workload_rg_id\n  tags                        = var.tags\n  address_prefix_management   = "manual"\n  default_network_acl_name    = null\n  default_security_group_name = null\n  default_routing_table_name  = null\n}\n\nresource "ibm_is_vpc_address_prefix" "workload_workload_zone_1_prefix" {\n  name = "${var.prefix}-workload-workload-zone-1"\n  vpc  = ibm_is_vpc.workload_vpc.id\n  zone = "${var.region}-1"\n  cidr = "10.40.0.0/22"\n}\n\nresource "ibm_is_vpc_address_prefix" "workload_workload_zone_2_prefix" {\n  name = "${var.prefix}-workload-workload-zone-2"\n  vpc  = ibm_is_vpc.workload_vpc.id\n  zone = "${var.region}-2"\n  cidr = "10.50.0.0/22"\n}\n\nresource "ibm_is_vpc_address_prefix" "workload_workload_zone_3_prefix" {\n  name = "${var.prefix}-workload-workload-zone-3"\n  vpc  = ibm_is_vpc.workload_vpc.id\n  zone = "${var.region}-3"\n  cidr = "10.60.0.0/22"\n}\n\nresource "ibm_is_subnet" "workload_vsi_zone_1" {\n  vpc             = ibm_is_vpc.workload_vpc.id\n  name            = "${var.prefix}-workload-vsi-zone-1"\n  zone            = "${var.region}-1"\n  resource_group  = var.workload_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.workload_workload_acl.id\n  ipv4_cidr_block = "10.40.0.0/28"\n  depends_on = [\n    ibm_is_vpc_address_prefix.workload_workload_zone_1_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "workload_vsi_zone_2" {\n  vpc             = ibm_is_vpc.workload_vpc.id\n  name            = "${var.prefix}-workload-vsi-zone-2"\n  zone            = "${var.region}-2"\n  resource_group  = var.workload_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.workload_workload_acl.id\n  ipv4_cidr_block = "10.50.0.0/28"\n  depends_on = [\n    ibm_is_vpc_address_prefix.workload_workload_zone_2_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "workload_vsi_zone_3" {\n  vpc             = ibm_is_vpc.workload_vpc.id\n  name            = "${var.prefix}-workload-vsi-zone-3"\n  zone            = "${var.region}-3"\n  resource_group  = var.workload_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.workload_workload_acl.id\n  ipv4_cidr_block = "10.60.0.0/28"\n  depends_on = [\n    ibm_is_vpc_address_prefix.workload_workload_zone_3_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "workload_vpe_zone_1" {\n  vpc             = ibm_is_vpc.workload_vpc.id\n  name            = "${var.prefix}-workload-vpe-zone-1"\n  zone            = "${var.region}-1"\n  resource_group  = var.workload_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.workload_workload_acl.id\n  ipv4_cidr_block = "10.40.0.32/29"\n  depends_on = [\n    ibm_is_vpc_address_prefix.workload_workload_zone_1_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "workload_vpe_zone_2" {\n  vpc             = ibm_is_vpc.workload_vpc.id\n  name            = "${var.prefix}-workload-vpe-zone-2"\n  zone            = "${var.region}-2"\n  resource_group  = var.workload_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.workload_workload_acl.id\n  ipv4_cidr_block = "10.50.0.32/29"\n  depends_on = [\n    ibm_is_vpc_address_prefix.workload_workload_zone_2_prefix\n  ]\n}\n\nresource "ibm_is_subnet" "workload_vpe_zone_3" {\n  vpc             = ibm_is_vpc.workload_vpc.id\n  name            = "${var.prefix}-workload-vpe-zone-3"\n  zone            = "${var.region}-3"\n  resource_group  = var.workload_rg_id\n  tags            = var.tags\n  network_acl     = ibm_is_network_acl.workload_workload_acl.id\n  ipv4_cidr_block = "10.60.0.32/29"\n  depends_on = [\n    ibm_is_vpc_address_prefix.workload_workload_zone_3_prefix\n  ]\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/workload_vpc/versions.tf",
          data: '##############################################################################\n# Terraform Providers\n##############################################################################\n\nterraform {\n  required_providers {\n    ibm = {\n      source  = "IBM-Cloud/ibm"\n      version = "~>1.56.1"\n    }\n  }\n  required_version = ">=1.3"\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/workload_vpc/variables.tf",
          data: '##############################################################################\n# Workload VPC Variables\n##############################################################################\n\nvariable "tags" {\n  description = "List of tags"\n  type        = list(string)\n}\n\nvariable "region" {\n  description = "IBM Cloud Region where resources will be provisioned"\n  type        = string\n  validation {\n    error_message = "Region must be in a supported IBM VPC region."\n    condition     = contains(["us-south", "us-east", "br-sao", "ca-tor", "eu-gb", "eu-de", "jp-tok", "jp-osa", "au-syd"], var.region)\n  }\n}\n\nvariable "prefix" {\n  description = "Name prefix that will be prepended to named resources"\n  type        = string\n  validation {\n    error_message = "Prefix must begin with a lowercase letter and contain only lowercase letters, numbers, and - characters. Prefixes must end with a lowercase letter or number and be 16 or fewer characters."\n    condition     = can(regex("^([a-z]|[a-z][-a-z0-9]*[a-z0-9])", var.prefix)) && length(var.prefix) <= 16\n  }\n}\n\nvariable "workload_rg_id" {\n  description = "ID for the resource group workload-rg"\n  type        = string\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/workload_vpc/acl_workload_workload.tf",
          data: '##############################################################################\n# Workload Workload ACL\n##############################################################################\n\nresource "ibm_is_network_acl" "workload_workload_acl" {\n  name           = "${var.prefix}-workload-workload-acl"\n  vpc            = ibm_is_vpc.workload_vpc.id\n  resource_group = var.workload_rg_id\n  tags = [\n    "hello",\n    "world"\n  ]\n  rules {\n    source      = "161.26.0.0/16"\n    action      = "allow"\n    destination = "10.0.0.0/8"\n    direction   = "inbound"\n    name        = "allow-ibm-inbound"\n  }\n  rules {\n    source      = "10.0.0.0/8"\n    action      = "allow"\n    destination = "161.26.0.0/16"\n    direction   = "outbound"\n    name        = "allow-ibm-outbound"\n  }\n  rules {\n    source      = "10.0.0.0/8"\n    action      = "allow"\n    destination = "10.0.0.0/8"\n    direction   = "inbound"\n    name        = "allow-all-network-inbound"\n  }\n  rules {\n    source      = "10.0.0.0/8"\n    action      = "allow"\n    destination = "10.0.0.0/8"\n    direction   = "outbound"\n    name        = "allow-all-network-outbound"\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/workload_vpc/sg_workload_vpe.tf",
          data: '##############################################################################\n# Security Group Workload VPE\n##############################################################################\n\nresource "ibm_is_security_group" "workload_vpc_workload_vpe_sg" {\n  name           = "${var.prefix}-workload-workload-vpe-sg"\n  vpc            = ibm_is_vpc.workload_vpc.id\n  resource_group = var.workload_rg_id\n  tags = [\n    "hello",\n    "world"\n  ]\n}\n\nresource "ibm_is_security_group_rule" "workload_vpc_workload_vpe_sg_rule_allow_ibm_inbound" {\n  group     = ibm_is_security_group.workload_vpc_workload_vpe_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "inbound"\n}\n\nresource "ibm_is_security_group_rule" "workload_vpc_workload_vpe_sg_rule_allow_vpc_inbound" {\n  group     = ibm_is_security_group.workload_vpc_workload_vpe_sg.id\n  remote    = "10.0.0.0/8"\n  direction = "inbound"\n}\n\nresource "ibm_is_security_group_rule" "workload_vpc_workload_vpe_sg_rule_allow_vpc_outbound" {\n  group     = ibm_is_security_group.workload_vpc_workload_vpe_sg.id\n  remote    = "10.0.0.0/8"\n  direction = "outbound"\n}\n\nresource "ibm_is_security_group_rule" "workload_vpc_workload_vpe_sg_rule_allow_ibm_tcp_53_outbound" {\n  group     = ibm_is_security_group.workload_vpc_workload_vpe_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "outbound"\n  tcp {\n    port_min = 53\n    port_max = 53\n  }\n}\n\nresource "ibm_is_security_group_rule" "workload_vpc_workload_vpe_sg_rule_allow_ibm_tcp_80_outbound" {\n  group     = ibm_is_security_group.workload_vpc_workload_vpe_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "outbound"\n  tcp {\n    port_min = 80\n    port_max = 80\n  }\n}\n\nresource "ibm_is_security_group_rule" "workload_vpc_workload_vpe_sg_rule_allow_ibm_tcp_443_outbound" {\n  group     = ibm_is_security_group.workload_vpc_workload_vpe_sg.id\n  remote    = "161.26.0.0/16"\n  direction = "outbound"\n  tcp {\n    port_min = 443\n    port_max = 443\n  }\n}\n\n##############################################################################\n',
        },
        {
          name: "craig/workload_vpc/outputs.tf",
          data: '##############################################################################\n# Workload VPC Outputs\n##############################################################################\n\noutput "id" {\n  value = ibm_is_vpc.workload_vpc.id\n}\n\noutput "crn" {\n  value = ibm_is_vpc.workload_vpc.crn\n}\n\noutput "vsi_zone_1_id" {\n  value = ibm_is_subnet.workload_vsi_zone_1.id\n}\n\noutput "vsi_zone_1_crn" {\n  value = ibm_is_subnet.workload_vsi_zone_1.crn\n}\n\noutput "vsi_zone_2_id" {\n  value = ibm_is_subnet.workload_vsi_zone_2.id\n}\n\noutput "vsi_zone_2_crn" {\n  value = ibm_is_subnet.workload_vsi_zone_2.crn\n}\n\noutput "vsi_zone_3_id" {\n  value = ibm_is_subnet.workload_vsi_zone_3.id\n}\n\noutput "vsi_zone_3_crn" {\n  value = ibm_is_subnet.workload_vsi_zone_3.crn\n}\n\noutput "vpe_zone_1_id" {\n  value = ibm_is_subnet.workload_vpe_zone_1.id\n}\n\noutput "vpe_zone_1_crn" {\n  value = ibm_is_subnet.workload_vpe_zone_1.crn\n}\n\noutput "vpe_zone_2_id" {\n  value = ibm_is_subnet.workload_vpe_zone_2.id\n}\n\noutput "vpe_zone_2_crn" {\n  value = ibm_is_subnet.workload_vpe_zone_2.crn\n}\n\noutput "vpe_zone_3_id" {\n  value = ibm_is_subnet.workload_vpe_zone_3.id\n}\n\noutput "vpe_zone_3_crn" {\n  value = ibm_is_subnet.workload_vpe_zone_3.crn\n}\n\noutput "workload_vpe_id" {\n  value = ibm_is_security_group.workload_vpc_workload_vpe_sg.id\n}\n\n##############################################################################\n',
        },
      ];
      let mockController = {
        createBlob: function () {
          return new ArrayBuffer(5);
        },
      };
      let tar = new mockPackTar();
      let api = new craigApi(mockController, tar);

      return api
        .craigTar(
          {
            body: slz,
          },
          res
        )
        .then(() => {
          assert.deepEqual(
            tar.files,
            expectedFiles,
            "it should set correct files"
          );
        });
    });
  });
});
