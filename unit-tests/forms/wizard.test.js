const { assert } = require("chai");
const { state } = require("../../client/src/lib/state");
const wizard = require("../../client/src/lib/forms/wizard");
/**
 * initialize store
 * @returns {lazyZState} state store
 */
function newState() {
  let store = new state();
  store.setUpdateCallback(() => {});
  return store;
}

describe("setup wizard", () => {
  it("should return default config", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Management VPC", "Workload VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: false,
        zones: 3,
        use_atracker: false,
        cos_vpe: true,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: false,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "management-rg", use_data: false },
        { use_prefix: true, name: "workload-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "management-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "workload-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "management-bucket",
          name: "management",
          resource_group: "management-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "management",
              zone: 1,
              name: "management-zone-1",
              cidr: "10.10.0.0/22",
            },
            {
              vpc: "management",
              zone: 2,
              name: "management-zone-2",
              cidr: "10.20.0.0/22",
            },
            {
              vpc: "management",
              zone: 3,
              name: "management-zone-3",
              cidr: "10.30.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "management",
              zone: 1,
              cidr: "10.10.0.0/29",
              name: "vsi-zone-1",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 2,
              cidr: "10.20.0.0/29",
              name: "vsi-zone-2",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 3,
              cidr: "10.30.0.0/29",
              name: "vsi-zone-3",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 1,
              cidr: "10.10.0.48/29",
              name: "vpe-zone-1",
              resource_group: "management-rg",
              network_acl: "management",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 2,
              cidr: "10.20.0.16/29",
              name: "vpe-zone-2",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 3,
              cidr: "10.30.0.16/29",
              name: "vpe-zone-3",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "management-rg",
              name: "management",
              vpc: "management",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
        {
          cos: "cos",
          bucket: "workload-bucket",
          name: "workload",
          resource_group: "workload-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "workload",
              zone: 1,
              name: "workload-zone-1",
              cidr: "10.40.0.0/22",
            },
            {
              vpc: "workload",
              zone: 2,
              name: "workload-zone-2",
              cidr: "10.50.0.0/22",
            },
            {
              vpc: "workload",
              zone: 3,
              name: "workload-zone-3",
              cidr: "10.60.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.0/28",
              name: "vsi-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.0/28",
              name: "vsi-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.0/28",
              name: "vsi-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.32/29",
              name: "vpe-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.32/29",
              name: "vpe-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.32/29",
              name: "vpe-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "workload-rg",
              name: "workload",
              vpc: "workload",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: false,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "management",
          name: "management-vpe",
          resource_group: "management-rg",
          rules: [
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
        {
          vpc: "workload",
          name: "workload-vpe",
          resource_group: "workload-rg",
          rules: [
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
        {
          vpc: "management",
          name: "management-vsi",
          resource_group: "management-rg",
          rules: [
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [
            { tgw: "transit-gateway", vpc: "management" },
            { tgw: "transit-gateway", vpc: "workload" },
          ],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "management-cos",
          service: "cos",
          vpc: "management",
          resource_group: "management-rg",
          security_groups: ["management-vpe"],
          subnets: ["vpe-zone-1", "vpe-zone-2", "vpe-zone-3"],
        },
        {
          name: "workload-cos",
          service: "cos",
          vpc: "workload",
          resource_group: "workload-rg",
          security_groups: ["workload-vpe"],
          subnets: ["vpe-zone-1", "vpe-zone-2", "vpe-zone-3"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };

    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with fs and hpcs", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Management VPC", "Workload VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: true,
        zones: 3,
        use_atracker: false,
        cos_vpe: true,
        key_management_service: "Bring Your Own HPCS",
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: true,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "management-rg", use_data: false },
        { use_prefix: true, name: "workload-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: true,
          authorize_vpc_reader_role: true,
          use_data: true,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "management-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "workload-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "management-bucket",
          name: "management",
          resource_group: "management-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "management",
              zone: 1,
              name: "management-zone-1",
              cidr: "10.10.0.0/22",
            },
            {
              vpc: "management",
              zone: 2,
              name: "management-zone-2",
              cidr: "10.20.0.0/22",
            },
            {
              vpc: "management",
              zone: 3,
              name: "management-zone-3",
              cidr: "10.30.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "management",
              zone: 1,
              cidr: "10.10.0.0/29",
              name: "vsi-zone-1",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 2,
              cidr: "10.20.0.0/29",
              name: "vsi-zone-2",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 3,
              cidr: "10.30.0.0/29",
              name: "vsi-zone-3",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 1,
              cidr: "10.10.0.48/29",
              name: "vpe-zone-1",
              resource_group: "management-rg",
              network_acl: "management",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 2,
              cidr: "10.20.0.16/29",
              name: "vpe-zone-2",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 3,
              cidr: "10.30.0.16/29",
              name: "vpe-zone-3",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "management-rg",
              name: "management",
              vpc: "management",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
        {
          cos: "cos",
          bucket: "workload-bucket",
          name: "workload",
          resource_group: "workload-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "workload",
              zone: 1,
              name: "workload-zone-1",
              cidr: "10.40.0.0/22",
            },
            {
              vpc: "workload",
              zone: 2,
              name: "workload-zone-2",
              cidr: "10.50.0.0/22",
            },
            {
              vpc: "workload",
              zone: 3,
              name: "workload-zone-3",
              cidr: "10.60.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.0/28",
              name: "vsi-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.0/28",
              name: "vsi-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.0/28",
              name: "vsi-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.32/29",
              name: "vpe-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.32/29",
              name: "vpe-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.32/29",
              name: "vpe-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "workload-rg",
              name: "workload",
              vpc: "workload",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: false,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "management",
          name: "management-vpe",
          resource_group: "management-rg",
          rules: [
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
        {
          vpc: "workload",
          name: "workload-vpe",
          resource_group: "workload-rg",
          rules: [
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
        {
          vpc: "management",
          name: "management-vsi",
          resource_group: "management-rg",
          rules: [
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [
            { tgw: "transit-gateway", vpc: "management" },
            { tgw: "transit-gateway", vpc: "workload" },
          ],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "management-cos",
          service: "cos",
          vpc: "management",
          resource_group: "management-rg",
          security_groups: ["management-vpe"],
          subnets: ["vpe-zone-1", "vpe-zone-2", "vpe-zone-3"],
        },
        {
          name: "workload-cos",
          service: "cos",
          vpc: "workload",
          resource_group: "workload-rg",
          security_groups: ["workload-vpe"],
          subnets: ["vpe-zone-1", "vpe-zone-2", "vpe-zone-3"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };

    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with only workload vpc", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Workload VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: false,
        zones: 3,
        use_atracker: false,
        cos_vpe: true,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: false,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "workload-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "workload-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "workload-bucket",
          name: "workload",
          resource_group: "workload-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "workload",
              zone: 1,
              name: "workload-zone-1",
              cidr: "10.40.0.0/22",
            },
            {
              vpc: "workload",
              zone: 2,
              name: "workload-zone-2",
              cidr: "10.50.0.0/22",
            },
            {
              vpc: "workload",
              zone: 3,
              name: "workload-zone-3",
              cidr: "10.60.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.0/28",
              name: "vsi-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.0/28",
              name: "vsi-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.0/28",
              name: "vsi-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.32/29",
              name: "vpe-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.32/29",
              name: "vpe-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.32/29",
              name: "vpe-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "workload-rg",
              name: "workload",
              vpc: "workload",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: false,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "workload",
          name: "workload-vpe",
          resource_group: "workload-rg",
          rules: [
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [{ tgw: "transit-gateway", vpc: "workload" }],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "workload-cos",
          service: "cos",
          vpc: "workload",
          resource_group: "workload-rg",
          security_groups: ["workload-vpe"],
          subnets: ["vpe-zone-1", "vpe-zone-2", "vpe-zone-3"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };

    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with only workload vpc with no cos vpe", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Workload VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: false,
        zones: 3,
        use_atracker: false,
        cos_vpe: false,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: false,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "workload-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "workload-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "workload-bucket",
          name: "workload",
          resource_group: "workload-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "workload",
              zone: 1,
              name: "workload-zone-1",
              cidr: "10.40.0.0/22",
            },
            {
              vpc: "workload",
              zone: 2,
              name: "workload-zone-2",
              cidr: "10.50.0.0/22",
            },
            {
              vpc: "workload",
              zone: 3,
              name: "workload-zone-3",
              cidr: "10.60.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.0/28",
              name: "vsi-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.0/28",
              name: "vsi-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.0/28",
              name: "vsi-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.32/29",
              name: "vpe-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.32/29",
              name: "vpe-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.32/29",
              name: "vpe-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "workload-rg",
              name: "workload",
              vpc: "workload",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: false,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "workload",
          name: "workload-vpe",
          resource_group: "workload-rg",
          rules: [
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [{ tgw: "transit-gateway", vpc: "workload" }],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };

    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with only management vpc", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Management VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: false,
        zones: 3,
        use_atracker: false,
        cos_vpe: true,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: false,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "management-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "management-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "management-bucket",
          name: "management",
          resource_group: "management-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "management",
              zone: 1,
              name: "management-zone-1",
              cidr: "10.10.0.0/22",
            },
            {
              vpc: "management",
              zone: 2,
              name: "management-zone-2",
              cidr: "10.20.0.0/22",
            },
            {
              vpc: "management",
              zone: 3,
              name: "management-zone-3",
              cidr: "10.30.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "management",
              zone: 1,
              cidr: "10.10.0.0/29",
              name: "vsi-zone-1",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 2,
              cidr: "10.20.0.0/29",
              name: "vsi-zone-2",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 3,
              cidr: "10.30.0.0/29",
              name: "vsi-zone-3",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 1,
              cidr: "10.10.0.48/29",
              name: "vpe-zone-1",
              resource_group: "management-rg",
              network_acl: "management",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 2,
              cidr: "10.20.0.16/29",
              name: "vpe-zone-2",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 3,
              cidr: "10.30.0.16/29",
              name: "vpe-zone-3",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "management-rg",
              name: "management",
              vpc: "management",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: false,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "management",
          name: "management-vpe",
          resource_group: "management-rg",
          rules: [
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
        {
          vpc: "management",
          name: "management-vsi",
          resource_group: "management-rg",
          rules: [
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [{ tgw: "transit-gateway", vpc: "management" }],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "management-cos",
          service: "cos",
          vpc: "management",
          resource_group: "management-rg",
          security_groups: ["management-vpe"],
          subnets: ["vpe-zone-1", "vpe-zone-2", "vpe-zone-3"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };

    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with no vpcs", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: [],
        use_tgw: true,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: false,
        zones: 3,
        use_atracker: false,
        cos_vpe: true,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: false,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [],
      atracker: {
        enabled: false,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };

    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with only management vpc and no tgw", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Management VPC"],
        use_tgw: false,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: false,
        zones: 3,
        use_atracker: false,
        cos_vpe: true,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: false,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "management-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "management-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "management-bucket",
          name: "management",
          resource_group: "management-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "management",
              zone: 1,
              name: "management-zone-1",
              cidr: "10.10.0.0/22",
            },
            {
              vpc: "management",
              zone: 2,
              name: "management-zone-2",
              cidr: "10.20.0.0/22",
            },
            {
              vpc: "management",
              zone: 3,
              name: "management-zone-3",
              cidr: "10.30.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "management",
              zone: 1,
              cidr: "10.10.0.0/29",
              name: "vsi-zone-1",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 2,
              cidr: "10.20.0.0/29",
              name: "vsi-zone-2",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 3,
              cidr: "10.30.0.0/29",
              name: "vsi-zone-3",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 1,
              cidr: "10.10.0.48/29",
              name: "vpe-zone-1",
              resource_group: "management-rg",
              network_acl: "management",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 2,
              cidr: "10.20.0.16/29",
              name: "vpe-zone-2",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "management",
              zone: 3,
              cidr: "10.30.0.16/29",
              name: "vpe-zone-3",
              network_acl: "management",
              resource_group: "management-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "management-rg",
              name: "management",
              vpc: "management",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "management",
                  vpc: "management",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: false,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "management",
          name: "management-vpe",
          resource_group: "management-rg",
          rules: [
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
        {
          vpc: "management",
          name: "management-vsi",
          resource_group: "management-rg",
          rules: [
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "management",
              sg: "management-vsi",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "management-cos",
          service: "cos",
          vpc: "management",
          resource_group: "management-rg",
          security_groups: ["management-vpe"],
          subnets: ["vpe-zone-1", "vpe-zone-2", "vpe-zone-3"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };

    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with atracker and only workload vpc", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Workload VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: false,
        zones: 3,
        use_atracker: true,
        cos_vpe: true,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: false,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "workload-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
            {
              dual_auth_delete: false,
              endpoint: "public",
              force_delete: true,
              key_ring: "ring",
              name: "atracker-key",
              root_key: true,
              rotation: 1,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "atracker-key",
              name: "atracker-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          keys: [
            {
              name: "cos-bind-key",
              role: "Writer",
              enable_hmac: false,
              use_random_suffix: true,
            },
          ],
          name: "atracker-cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          use_random_suffix: true,
          kms: "kms",
        },
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "workload-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "workload-bucket",
          name: "workload",
          resource_group: "workload-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "workload",
              zone: 1,
              name: "workload-zone-1",
              cidr: "10.40.0.0/22",
            },
            {
              vpc: "workload",
              zone: 2,
              name: "workload-zone-2",
              cidr: "10.50.0.0/22",
            },
            {
              vpc: "workload",
              zone: 3,
              name: "workload-zone-3",
              cidr: "10.60.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.0/28",
              name: "vsi-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.0/28",
              name: "vsi-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.0/28",
              name: "vsi-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.32/29",
              name: "vpe-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.32/29",
              name: "vpe-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.32/29",
              name: "vpe-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "workload-rg",
              name: "workload",
              vpc: "workload",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: true,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "workload",
          name: "workload-vpe",
          resource_group: "workload-rg",
          rules: [
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [{ tgw: "transit-gateway", vpc: "workload" }],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "workload-cos",
          service: "cos",
          vpc: "workload",
          resource_group: "workload-rg",
          security_groups: ["workload-vpe"],
          subnets: ["vpe-zone-1", "vpe-zone-2", "vpe-zone-3"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };
    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with atracker and only workload vpc with fs cloud", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Workload VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: true,
        zones: 3,
        use_atracker: true,
        cos_vpe: true,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: true,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "workload-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
            {
              dual_auth_delete: false,
              endpoint: "public",
              force_delete: true,
              key_ring: "ring",
              name: "atracker-key",
              root_key: true,
              rotation: 1,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "atracker-key",
              name: "atracker-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          keys: [
            {
              name: "cos-bind-key",
              role: "Writer",
              enable_hmac: false,
              use_random_suffix: true,
            },
          ],
          name: "atracker-cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          use_random_suffix: true,
          kms: "kms",
        },
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "workload-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "workload-bucket",
          name: "workload",
          resource_group: "workload-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "workload",
              zone: 1,
              name: "workload-zone-1",
              cidr: "10.40.0.0/22",
            },
            {
              vpc: "workload",
              zone: 2,
              name: "workload-zone-2",
              cidr: "10.50.0.0/22",
            },
            {
              vpc: "workload",
              zone: 3,
              name: "workload-zone-3",
              cidr: "10.60.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.0/28",
              name: "vsi-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.0/28",
              name: "vsi-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.0/28",
              name: "vsi-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.32/29",
              name: "vpe-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 2,
              cidr: "10.50.0.32/29",
              name: "vpe-zone-2",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 3,
              cidr: "10.60.0.32/29",
              name: "vpe-zone-3",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "workload-rg",
              name: "workload",
              vpc: "workload",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: true,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "workload",
          name: "workload-vpe",
          resource_group: "workload-rg",
          rules: [
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [{ tgw: "transit-gateway", vpc: "workload" }],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "workload-cos",
          service: "cos",
          vpc: "workload",
          resource_group: "workload-rg",
          security_groups: ["workload-vpe"],
          subnets: ["vpe-zone-1", "vpe-zone-2", "vpe-zone-3"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };
    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with atracker and only workload vpc with fs cloud and only one zone", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Workload VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: false,
        fs_cloud: true,
        zones: 1,
        use_atracker: true,
        cos_vpe: true,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: true,
        dynamic_subnets: true,
        enable_power_vs: false,
        power_vs_zones: [],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "workload-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
            {
              dual_auth_delete: false,
              endpoint: "public",
              force_delete: true,
              key_ring: "ring",
              name: "atracker-key",
              root_key: true,
              rotation: 1,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "atracker-key",
              name: "atracker-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          keys: [
            {
              name: "cos-bind-key",
              role: "Writer",
              enable_hmac: false,
              use_random_suffix: true,
            },
          ],
          name: "atracker-cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          use_random_suffix: true,
          kms: "kms",
        },
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "workload-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "workload-bucket",
          name: "workload",
          resource_group: "workload-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "workload",
              zone: 1,
              name: "workload-zone-1",
              cidr: "10.40.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.0/28",
              name: "vsi-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.32/29",
              name: "vpe-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "workload-rg",
              name: "workload",
              vpc: "workload",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: true,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "workload",
          name: "workload-vpe",
          resource_group: "workload-rg",
          rules: [
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [{ tgw: "transit-gateway", vpc: "workload" }],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "workload-cos",
          service: "cos",
          vpc: "workload",
          resource_group: "workload-rg",
          security_groups: ["workload-vpe"],
          subnets: ["vpe-zone-1"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };
    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with atracker and only workload vpc with fs cloud and only one zone & power vs", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Workload VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: true,
        fs_cloud: true,
        zones: 1,
        use_atracker: true,
        cos_vpe: true,
        power_vs_zones: ["dal10"],
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: true,
        dynamic_subnets: true,
        enable_power_vs: true,
        power_vs_zones: ["dal10"],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "workload-rg", use_data: false },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
            {
              dual_auth_delete: false,
              endpoint: "public",
              force_delete: true,
              key_ring: "ring",
              name: "atracker-key",
              root_key: true,
              rotation: 1,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "atracker-key",
              name: "atracker-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          keys: [
            {
              name: "cos-bind-key",
              role: "Writer",
              enable_hmac: false,
              use_random_suffix: true,
            },
          ],
          name: "atracker-cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          use_random_suffix: true,
          kms: "kms",
        },
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "workload-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: "cos",
          bucket: "workload-bucket",
          name: "workload",
          resource_group: "workload-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "workload",
              zone: 1,
              name: "workload-zone-1",
              cidr: "10.40.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.0/28",
              name: "vsi-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.32/29",
              name: "vpe-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "workload-rg",
              name: "workload",
              vpc: "workload",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: true,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          vpc: "workload",
          name: "workload-vpe",
          resource_group: "workload-rg",
          rules: [
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [{ tgw: "transit-gateway", vpc: "workload" }],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "workload-cos",
          service: "cos",
          vpc: "workload",
          resource_group: "workload-rg",
          security_groups: ["workload-vpe"],
          subnets: ["vpe-zone-1"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };
    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
  it("should return default config with atracker and only workload vpc with fs cloud and only one zone & power vs & f5", () => {
    let wizardState = newState();
    let actualData = wizard(
      {
        vpc_networks: ["Workload VPC"],
        use_tgw: true,
        region: "us-south",
        use_power_vs: true,
        fs_cloud: true,
        zones: 1,
        use_atracker: true,
        cos_vpe: true,
        power_vs_zones: ["dal10"],
        use_f5: true,
      },
      wizardState.store.json
    );
    let expectedData = {
      iam_account_settings: {
        enable: false,
        mfa: null,
        allowed_ip_addresses: null,
        include_history: false,
        if_match: null,
        max_sessions_per_identity: null,
        restrict_create_service_id: null,
        restrict_create_platform_apikey: null,
        session_expiration_in_seconds: null,
        session_invalidation_in_seconds: null,
      },
      access_groups: [],
      secrets_manager: [],
      f5_vsi: [],
      _options: {
        prefix: "wizard",
        region: "us-south",
        tags: ["craig", "wizard"],
        zones: 3,
        endpoints: "private",
        account_id: "",
        fs_cloud: true,
        dynamic_subnets: false,
        enable_power_vs: true,
        power_vs_zones: ["dal10"],
        craig_version: "1.4.0",
      },
      resource_groups: [
        { use_prefix: true, name: "service-rg", use_data: false },
        { use_prefix: true, name: "workload-rg", use_data: false },
        { use_data: false, use_prefix: true, name: "edge-rg" },
      ],
      key_management: [
        {
          name: "kms",
          resource_group: "service-rg",
          use_hs_crypto: false,
          authorize_vpc_reader_role: true,
          use_data: false,
          keys: [
            {
              key_ring: "ring",
              name: "key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
            {
              key_ring: "ring",
              name: "atracker-key",
              root_key: true,
              force_delete: true,
              endpoint: "public",
              rotation: 1,
              dual_auth_delete: false,
            },
          ],
        },
      ],
      object_storage: [
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "atracker-key",
              name: "atracker-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          keys: [
            {
              name: "cos-bind-key",
              role: "Writer",
              enable_hmac: false,
              use_random_suffix: true,
            },
          ],
          name: "atracker-cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          use_random_suffix: true,
          kms: "kms",
        },
        {
          buckets: [
            {
              endpoint: "public",
              force_delete: true,
              kms_key: "key",
              name: "workload-bucket",
              storage_class: "standard",
              use_random_suffix: true,
            },
          ],
          use_random_suffix: true,
          keys: [],
          name: "cos",
          plan: "standard",
          resource_group: "service-rg",
          use_data: false,
          kms: "kms",
        },
      ],
      vpcs: [
        {
          cos: null,
          bucket: null,
          name: "edge",
          resource_group: "edge-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_routing_table_name: null,
          default_security_group_name: null,
          address_prefixes: [{ vpc: "edge", zone: 1, cidr: "10.5.0.0/16" }],
          acls: [
            {
              name: "edge-acl",
              vpc: "edge",
              resource_group: "edge-rg",
              rules: [
                {
                  acl: "edge-acl",
                  vpc: "edge",
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  tcp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  icmp: { code: null, type: null },
                  udp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  acl: "edge-acl",
                  vpc: "edge",
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  tcp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  icmp: { code: null, type: null },
                  udp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  acl: "edge-acl",
                  vpc: "edge",
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  tcp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  icmp: { code: null, type: null },
                  udp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
            {
              name: "f5-external-acl",
              vpc: "edge",
              resource_group: "edge-rg",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "f5-external-acl",
                  vpc: "edge",
                  tcp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  icmp: { code: null, type: null },
                  udp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "f5-external-acl",
                  vpc: "edge",
                  tcp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  icmp: { code: null, type: null },
                  udp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "f5-external-acl",
                  vpc: "edge",
                  tcp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  icmp: { code: null, type: null },
                  udp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-f5-external-443-inbound",
                  source: "0.0.0.0/0",
                  acl: "f5-external-acl",
                  vpc: "edge",
                  tcp: {
                    port_max: 443,
                    port_min: 443,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  icmp: { code: null, type: null },
                  udp: {
                    port_max: null,
                    port_min: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
          subnets: [
            {
              vpc: "edge",
              name: "f5-bastion-zone-1",
              zone: 1,
              resource_group: "edge-rg",
              cidr: "10.5.60.0/24",
              network_acl: "edge-acl",
              public_gateway: false,
              has_prefix: true,
            },
            {
              vpc: "edge",
              name: "f5-external-zone-1",
              zone: 1,
              resource_group: "edge-rg",
              cidr: "10.5.40.0/24",
              network_acl: "f5-external-acl",
              public_gateway: false,
              has_prefix: true,
            },
            {
              vpc: "edge",
              name: "f5-management-zone-1",
              zone: 1,
              resource_group: "edge-rg",
              cidr: "10.5.30.0/24",
              network_acl: "edge-acl",
              public_gateway: false,
              has_prefix: true,
            },
            {
              vpc: "edge",
              name: "f5-workload-zone-1",
              zone: 1,
              resource_group: "edge-rg",
              cidr: "10.5.50.0/24",
              network_acl: "edge-acl",
              public_gateway: false,
              has_prefix: true,
            },
            {
              vpc: "edge",
              name: "vpe-zone-1",
              zone: 1,
              resource_group: "edge-rg",
              cidr: "10.5.70.0/24",
              network_acl: "edge-acl",
              public_gateway: false,
              has_prefix: true,
            },
            {
              vpc: "edge",
              name: "vpn-1-zone-1",
              zone: 1,
              resource_group: "edge-rg",
              cidr: "10.5.10.0/24",
              network_acl: "edge-acl",
              public_gateway: false,
              has_prefix: true,
            },
            {
              vpc: "edge",
              name: "vpn-2-zone-1",
              zone: 1,
              resource_group: "edge-rg",
              cidr: "10.5.20.0/24",
              network_acl: "edge-acl",
              public_gateway: false,
              has_prefix: true,
            },
          ],
          public_gateways: [],
        },
        {
          cos: "cos",
          bucket: "workload-bucket",
          name: "workload",
          resource_group: "workload-rg",
          classic_access: false,
          manual_address_prefix_management: true,
          default_network_acl_name: null,
          default_security_group_name: null,
          default_routing_table_name: null,
          publicGateways: [],
          address_prefixes: [
            {
              vpc: "workload",
              zone: 1,
              name: "workload-zone-1",
              cidr: "10.40.0.0/22",
            },
          ],
          subnets: [
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.0/28",
              name: "vsi-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
            {
              vpc: "workload",
              zone: 1,
              cidr: "10.40.0.32/29",
              name: "vpe-zone-1",
              network_acl: "workload",
              resource_group: "workload-rg",
              public_gateway: false,
              has_prefix: false,
            },
          ],
          public_gateways: [],
          acls: [
            {
              resource_group: "workload-rg",
              name: "workload",
              vpc: "workload",
              rules: [
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-ibm-inbound",
                  source: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  source: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-ibm-outbound",
                  destination: "161.26.0.0/16",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "inbound",
                  name: "allow-all-network-inbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
                {
                  action: "allow",
                  destination: "10.0.0.0/8",
                  direction: "outbound",
                  name: "allow-all-network-outbound",
                  source: "10.0.0.0/8",
                  acl: "workload",
                  vpc: "workload",
                  icmp: { type: null, code: null },
                  tcp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                  udp: {
                    port_min: null,
                    port_max: null,
                    source_port_min: null,
                    source_port_max: null,
                  },
                },
              ],
            },
          ],
        },
      ],
      atracker: {
        enabled: true,
        type: "cos",
        name: "atracker",
        target_name: "atracker-cos",
        bucket: "atracker-bucket",
        add_route: true,
        cos_key: "cos-bind-key",
        locations: ["global", "us-south"],
      },
      appid: [],
      scc: {
        credential_description: null,
        id: null,
        passphrase: null,
        name: "",
        location: "us",
        collector_description: null,
        is_public: false,
        scope_description: null,
        enable: false,
      },
      ssh_keys: [],
      security_groups: [
        {
          name: "f5-management-sg",
          resource_group: "edge-rg",
          rules: [
            {
              sg: "f5-management-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-management-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-management-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-management-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-management-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-management-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
          ],
          vpc: "edge",
        },
        {
          name: "f5-external-sg",
          resource_group: "edge-rg",
          rules: [
            {
              sg: "f5-external-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-inbound-443",
              source: "0.0.0.0/0",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
          ],
          vpc: "edge",
        },
        {
          name: "f5-workload-sg",
          resource_group: "edge-rg",
          rules: [
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-workload-subnet-1",
              source: "10.10.10.0/24",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-workload-subnet-2",
              source: "10.20.10.0/24",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-workload-subnet-3",
              source: "10.30.10.0/24",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-workload-subnet-4",
              source: "10.40.10.0/24",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-workload-subnet-5",
              source: "10.50.10.0/24",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-workload-subnet-6",
              source: "10.60.10.0/24",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-workload-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
          ],
          vpc: "edge",
        },
        {
          name: "f5-bastion-sg",
          resource_group: "edge-rg",
          rules: [
            {
              sg: "f5-bastion-sg",
              vpc: "edge",
              direction: "inbound",
              name: "1-inbound-3023",
              source: "10.5.80.0/24",
              tcp: { port_max: 3025, port_min: 3023 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-bastion-sg",
              vpc: "edge",
              direction: "inbound",
              name: "1-inbound-3080",
              source: "10.5.80.0/24",
              tcp: { port_max: 3080, port_min: 3080 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-bastion-sg",
              vpc: "edge",
              direction: "inbound",
              name: "2-inbound-3023",
              source: "10.6.80.0/24",
              tcp: { port_max: 3025, port_min: 3023 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-bastion-sg",
              vpc: "edge",
              direction: "inbound",
              name: "2-inbound-3080",
              source: "10.6.80.0/24",
              tcp: { port_max: 3080, port_min: 3080 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-bastion-sg",
              vpc: "edge",
              direction: "inbound",
              name: "3-inbound-3023",
              source: "10.7.80.0/24",
              tcp: { port_max: 3025, port_min: 3023 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "f5-bastion-sg",
              vpc: "edge",
              direction: "inbound",
              name: "3-inbound-3080",
              source: "10.7.80.0/24",
              tcp: { port_max: 3080, port_min: 3080 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
          ],
          vpc: "edge",
        },
        {
          name: "edge-vpe-sg",
          resource_group: "edge-rg",
          rules: [
            {
              sg: "edge-vpe-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "edge-vpe-sg",
              vpc: "edge",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "edge-vpe-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "edge-vpe-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "edge-vpe-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
            {
              sg: "edge-vpe-sg",
              vpc: "edge",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              icmp: { code: null, type: null },
              udp: { port_max: null, port_min: null },
            },
          ],
          vpc: "edge",
        },
        {
          vpc: "workload",
          name: "workload-vpe",
          resource_group: "workload-rg",
          rules: [
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-ibm-inbound",
              source: "161.26.0.0/16",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "inbound",
              name: "allow-vpc-inbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-vpc-outbound",
              source: "10.0.0.0/8",
              tcp: { port_max: null, port_min: null },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-53-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 53, port_min: 53 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-80-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 80, port_min: 80 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
            {
              vpc: "workload",
              sg: "workload-vpe",
              direction: "outbound",
              name: "allow-ibm-tcp-443-outbound",
              source: "161.26.0.0/16",
              tcp: { port_max: 443, port_min: 443 },
              udp: { port_max: null, port_min: null },
              icmp: { type: null, code: null },
            },
          ],
        },
      ],
      transit_gateways: [
        {
          name: "transit-gateway",
          resource_group: "service-rg",
          global: false,
          connections: [{ tgw: "transit-gateway", vpc: "workload" }],
        },
      ],
      vpn_gateways: [],
      clusters: [],
      vsi: [],
      teleport_vsi: [],
      virtual_private_endpoints: [
        {
          name: "workload-cos",
          service: "cos",
          vpc: "workload",
          resource_group: "workload-rg",
          security_groups: ["workload-vpe"],
          subnets: ["vpe-zone-1"],
        },
      ],
      load_balancers: [],
      event_streams: [],
      routing_tables: [],
      cbr_zones: [],
      cbr_rules: [],
      vpn_servers: [],
      dns: [],
      logdna: {
        enabled: false,
        plan: "lite",
        endpoints: "private",
        platform_logs: false,
        resource_group: "service-rg",
        cos: "atracker-cos",
        bucket: "atracker-bucket",
      },
      sysdig: {
        enabled: false,
        plan: "graduated-tier",
        resource_group: "service-rg",
      },
      icd: [],
      power: [],
      power_instances: [],
      power_volumes: [],
    };
    assert.deepEqual(
      actualData,
      expectedData,
      "it should return the default config"
    );
  });
});
